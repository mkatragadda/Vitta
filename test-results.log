
> vitta@0.1.0 test
> jest

FAIL __tests__/unit/components/ToastNotification.test.js
  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'indexOf')

       5 |
       6 | describe('ToastNotification', () => {
    >  7 |   describe('Types', () => {
         |                 ^
       8 |     test('should render success toast', () => {
       9 |       render(<ToastNotification type="success" message="Operation successful" />);
      10 |       expect(screen.getByText('Operation successful')).toBeInTheDocument();

      at node_modules/react-dom/cjs/react-dom.development.js:29890:29
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom.development.js:29922:5)
      at Object.<anonymous> (node_modules/react-dom/index.js:37:20)
      at node_modules/react-dom/cjs/react-dom-test-utils.development.js:18:16
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1762:5)
      at Object.<anonymous> (node_modules/react-dom/test-utils.js:6:20)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/act-compat.js:10:56)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/index.js:6:18)
      at Object.<anonymous> (__tests__/unit/components/ToastNotification.test.js:7:17)

FAIL __tests__/unit/components/SyncStatus.test.js
  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'indexOf')

       5 |
       6 | describe('SyncStatus', () => {
    >  7 |   const mockOperations = [
         |                 ^
       8 |     {
       9 |       id: 'op-1',
      10 |       type: 'message',

      at node_modules/react-dom/cjs/react-dom.development.js:29890:29
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom.development.js:29922:5)
      at Object.<anonymous> (node_modules/react-dom/index.js:37:20)
      at node_modules/react-dom/cjs/react-dom-test-utils.development.js:18:16
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1762:5)
      at Object.<anonymous> (node_modules/react-dom/test-utils.js:6:20)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/act-compat.js:10:56)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/index.js:6:18)
      at Object.<anonymous> (__tests__/unit/components/SyncStatus.test.js:7:17)

FAIL __tests__/unit/components/OfflineIndicator.test.js
  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'indexOf')

       5 |
       6 | describe('OfflineIndicator', () => {
    >  7 |   describe('Online Status', () => {
         |                 ^
       8 |     test('should not show when online with no pending operations', () => {
       9 |       const { container } = render(
      10 |         <OfflineIndicator isOnline={true} queueLength={0} syncStatus="idle" />

      at node_modules/react-dom/cjs/react-dom.development.js:29890:29
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom.development.js:29922:5)
      at Object.<anonymous> (node_modules/react-dom/index.js:37:20)
      at node_modules/react-dom/cjs/react-dom-test-utils.development.js:18:16
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1762:5)
      at Object.<anonymous> (node_modules/react-dom/test-utils.js:6:20)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/act-compat.js:10:56)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/index.js:6:18)
      at Object.<anonymous> (__tests__/unit/components/OfflineIndicator.test.js:7:17)

  console.error
    [SyncManager] Failed to sync card add: API error: 503

      205 |       }
      206 |     } catch (error) {
    > 207 |       console.error(`[SyncManager] Failed to sync card add: ${error.message}`);
          |               ^
      208 |       return this.handleRetry(operation);
      209 |     }
      210 |   }

      at SyncManager.error [as syncCardAdd] (services/sync/syncManager.js:207:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:132:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/cardOperationsFlow.test.js:260:20)

  console.error
    [SyncManager] Failed to sync card add: API error: 400

      205 |       }
      206 |     } catch (error) {
    > 207 |       console.error(`[SyncManager] Failed to sync card add: ${error.message}`);
          |               ^
      208 |       return this.handleRetry(operation);
      209 |     }
      210 |   }

      at SyncManager.error [as syncCardAdd] (services/sync/syncManager.js:207:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:132:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/cardOperationsFlow.test.js:297:22)

  console.error
    [SyncManager] Failed to sync card add: API error: 500

      205 |       }
      206 |     } catch (error) {
    > 207 |       console.error(`[SyncManager] Failed to sync card add: ${error.message}`);
          |               ^
      208 |       return this.handleRetry(operation);
      209 |     }
      210 |   }

      at SyncManager.error [as syncCardAdd] (services/sync/syncManager.js:207:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:132:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/cardOperationsFlow.test.js:297:22)

  console.error
    [SyncManager] Failed to sync card add: API error: 400

      205 |       }
      206 |     } catch (error) {
    > 207 |       console.error(`[SyncManager] Failed to sync card add: ${error.message}`);
          |               ^
      208 |       return this.handleRetry(operation);
      209 |     }
      210 |   }

      at SyncManager.error [as syncCardAdd] (services/sync/syncManager.js:207:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:132:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/cardOperationsFlow.test.js:334:22)

  console.error
    [SyncManager] Failed to sync card update: API error: 404

      238 |       }
      239 |     } catch (error) {
    > 240 |       console.error(`[SyncManager] Failed to sync card update: ${error.message}`);
          |               ^
      241 |       return this.handleRetry(operation);
      242 |     }
      243 |   }

      at SyncManager.error [as syncCardUpdate] (services/sync/syncManager.js:240:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:134:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/cardOperationsFlow.test.js:334:22)

PASS __tests__/integration/sync/cardOperationsFlow.test.js
  Card Operations Offline/Online Flow
    offline card operations workflow
      âœ“ should queue multiple card operations when offline (18 ms)
      âœ“ should process queued card operations on reconnect (28 ms)
      âœ“ should use correct API endpoints for each operation type (11 ms)
      âœ“ should maintain FIFO order for card operations (19 ms)
      âœ“ should handle mixed card operations in correct order (7 ms)
    card operation failures and retries
      âœ“ should retry failed card operation with exponential backoff (266 ms)
      âœ“ should handle partial success (some card ops fail, some succeed) (8 ms)
      âœ“ should distinguish between different operation types in errors (97 ms)
    card operations with events
      âœ“ should emit events for each card operation (7 ms)
      âœ“ should provide operation details in queued event (2 ms)
    card operation persistence
      âœ“ should persist card operations to storage (2 ms)
      âœ“ should remove synced card operations from storage (10 ms)
    stress testing card operations
      âœ“ should handle large batch of card operations (4 ms)
      âœ“ should handle mixed operation types at scale (3 ms)

  console.error
    [SyncManager] Failed to sync message: API error: 503 - Service unavailable

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/offlineOnlineFlow.test.js:95:22)

  console.error
    [SyncManager] Failed to sync message: API error: 400 - Bad request

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/offlineOnlineFlow.test.js:166:22)

  console.error
    [OfflineDetector] Listener error for test: Error: Listener error
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/offline/offlineDetector.test.js:112:15)
        at /Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
        at Object.mockConstructor [as callback] (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
        at callback (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/offline/offlineDetector.js:157:20)
        at Array.forEach (<anonymous>)
        at OfflineDetector.forEach [as notify] (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/offline/offlineDetector.js:154:20)
        at notify (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/offline/offlineDetector.test.js:120:29)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/expect/build/toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/expect/build/index.js:320:21)
        at Object.toThrow (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/offline/offlineDetector.test.js:120:49)
        at Promise.then.completed (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/testWorker.js:106:12)

      157 |           listener.callback(data)
      158 |         } catch (error) {
    > 159 |           console.error(`[OfflineDetector] Listener error for ${event}:`, error)
          |                   ^
      160 |         }
      161 |       }
      162 |     })

      at error (services/offline/offlineDetector.js:159:19)
          at Array.forEach (<anonymous>)
      at OfflineDetector.forEach [as notify] (services/offline/offlineDetector.js:154:20)
      at notify (__tests__/unit/offline/offlineDetector.test.js:120:29)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/offline/offlineDetector.test.js:120:49)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/integration/sync/offlineOnlineFlow.test.js:166:22)

PASS __tests__/integration/sync/offlineOnlineFlow.test.js
  Offline/Online Flow Integration
    complete offline workflow
      âœ“ should queue operations when offline and sync on reconnect (66 ms)
      âœ“ should retry failed operations with exponential backoff (283 ms)
    multiple offline periods
      âœ“ should accumulate operations across multiple offline periods (1 ms)
    sync conflict scenarios
      âœ“ should handle partial sync (some operations succeed, some fail) (36 ms)
      âœ“ should maintain FIFO order of operations (2 ms)
    data persistence
      âœ“ should persist operations to storage (1 ms)
      âœ“ should remove operations from storage after sync (1 ms)
    event notifications
      âœ“ should emit events throughout sync lifecycle (2 ms)
      âœ“ should provide operation details in events (3 ms)
    stress testing
      âœ“ should handle large queue (100+ operations) (75 ms)
      âœ“ should handle mixed operation types at scale (4 ms)

PASS __tests__/unit/offline/offlineDetector.test.js
  Offline Detector
    Initialization
      âœ“ should initialize with online state (41 ms)
      âœ“ should initialize with idle sync status (1 ms)
      âœ“ should have empty listeners array (1 ms)
      âœ“ should have init method
      âœ“ should have destroy method (3 ms)
    Event listeners
      âœ“ on method should add listener (1 ms)
      âœ“ on method should return unsubscribe function (2 ms)
      âœ“ should allow multiple listeners for same event (1 ms)
      âœ“ should allow different event types (1 ms)
    Notifications
      âœ“ notify should call matching listeners (65 ms)
      âœ“ notify should not call non-matching listeners (2 ms)
      âœ“ notify should handle listener errors gracefully (333 ms)
    Status methods
      âœ“ getStatus should return current status (14 ms)
      âœ“ getStatus should reflect online state (1 ms)
      âœ“ getStatus should reflect sync state
    Online/Offline handling
      âœ“ handleOnline should set isOnline to true (87 ms)
      âœ“ handleOnline should notify online (4 ms)
      âœ“ handleOffline should set isOnline to false (42 ms)
      âœ“ handleOffline should notify offline (1 ms)
    Sync operations
      âœ“ triggerSync should return a promise (1 ms)
      âœ“ triggerSync should set syncInProgress flag (11 ms)
      âœ“ triggerSync should not start if already syncing (1 ms)
      âœ“ triggerSync should notify sync:start (4 ms)
      âœ“ triggerSync should notify sync:end or sync:error (3 ms)
    Connectivity checking
      âœ“ checkConnectivity should return a promise (1 ms)
      âœ“ checkConnectivity should use fetch
    Cleanup
      âœ“ destroy should clear listeners
      âœ“ destroy should clear check interval (1 ms)
    Class instantiation
      âœ“ should be able to create new instances (1 ms)
      âœ“ instances should have independent listeners (1 ms)

FAIL __tests__/unit/reminderPlanner.test.js
  Reminder Planner - Baseline Schedule
    âœ“ generates pre-due reminders at -7/-3/0 for upcoming payment (4 ms)
    âœ• includes day-of and post-due reminder when payment is due today (23 ms)
    âœ“ schedules only future post-due reminders for overdue payments (1 ms)
    âœ• respects quiet hours by shifting to end of quiet window (1 ms)
  Reminder Planner - Deduplication & Summary
    âœ“ filterExistingReminders removes duplicates within tolerance window (1 ms)
    âœ“ summarizeReminderPlan returns next reminder and grouping (8 ms)

  â— Reminder Planner - Baseline Schedule â€º includes day-of and post-due reminder when payment is due today

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 1
    Received array:  [{"card_id": "card-2", "channel": ["in_app"], "id": "card-2-payment_due-1762790400000", "lead_time_days": 0, "payload": {"amountDue": 1000, "cardNickname": "Bofa Travel", "daysUntilDue": 1, "dueDate": "2025-11-10T08:00:00.000Z", "urgency": "soon", "urgencyEmoji": "ðŸŸ¡"}, "priority": 100, "reminder_type": "payment_due", "status": "scheduled", "target_datetime": "2025-11-10T16:00:00.000Z", "trigger_date": "2025-11-10", "user_id": "user-123"}]

      79 |
      80 |     // -3 (Nov 7) should be filtered because it's in the past; expect day-of + post-due
    > 81 |     expect(reminders).toHaveLength(2);
         |                       ^
      82 |     expect(reminders.map(r => r.lead_time_days)).toEqual([0, 1]);
      83 |     const dayOf = new Date(reminders[0].target_datetime);
      84 |     const postDue = new Date(reminders[1].target_datetime);

      at Object.toHaveLength (__tests__/unit/reminderPlanner.test.js:81:23)

  â— Reminder Planner - Baseline Schedule â€º respects quiet hours by shifting to end of quiet window

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      140 |     });
      141 |
    > 142 |     expect(reminders).toHaveLength(1);
          |                       ^
      143 |     const reminderDate = new Date(reminders[0].target_datetime);
      144 |     expect(reminderDate.getHours()).toBe(8); // shifted to quietHours.end
      145 |   });

      at Object.toHaveLength (__tests__/unit/reminderPlanner.test.js:142:23)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

FAIL __tests__/unit/fieldExtraction.test.js (5.31 s)
  Field Extraction - extractAttribute
    Identity Fields
      âœ“ extracts card_name (418 ms)
      âœ“ extracts nickname (36 ms)
      âœ• extracts card_type (74 ms)
      âœ“ extracts issuer (33 ms)
      âœ“ extracts card_network (46 ms)
    Financial Fields
      âœ• extracts apr (11 ms)
      âœ“ extracts balance (75 ms)
      âœ• extracts credit_limit (46 ms)
      âœ“ extracts annual_fee (39 ms)
      âœ“ extracts payment_amount (19 ms)
    Date/Time Fields
      âœ• extracts due_date (141 ms)
      âœ“ extracts statement_close (20 ms)
      âœ“ extracts statement_start (47 ms)
      âœ“ extracts grace_period (27 ms)
    Computed Fields
      âœ“ extracts utilization (57 ms)
      âœ“ extracts available_credit (17 ms)
    Rewards Fields
      âœ• extracts rewards (17 ms)
    Edge Cases
      âœ“ returns null for non-field queries (70 ms)
      âœ“ prioritizes more specific patterns (46 ms)
      âœ“ handles queries with multiple field mentions (first wins) (7 ms)
    Real-world Query Examples
      âœ“ extracts from complex queries (39 ms)
      âœ“ handles queries with modifiers (65 ms)

  â— Field Extraction - extractAttribute â€º Identity Fields â€º extracts card_type

    expect(received).toBe(expected) // Object.is equality

    Expected: "card_type"
    Received: null

      31 |
      32 |     test('extracts card_type', () => {
    > 33 |       expect(getAttribute("what type of card is this")).toBe('card_type');
         |                                                         ^
      34 |       expect(getAttribute("what kind of card")).toBe('card_type');
      35 |       expect(getAttribute("card kind")).toBe('card_type');
      36 |     });

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:33:57)

  â— Field Extraction - extractAttribute â€º Financial Fields â€º extracts apr

    expect(received).toBe(expected) // Object.is equality

    Expected: "apr"
    Received: null

      60 |       expect(getAttribute("interest rate")).toBe('apr');
      61 |       expect(getAttribute("annual percentage rate")).toBe('apr');
    > 62 |       expect(getAttribute("show me rate")).toBe('apr');
         |                                            ^
      63 |     });
      64 |
      65 |     test('extracts balance', () => {

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:62:44)

  â— Field Extraction - extractAttribute â€º Financial Fields â€º extracts credit_limit

    expect(received).toBe(expected) // Object.is equality

    Expected: "credit_limit"
    Received: null

      75 |       expect(getAttribute("show me limit")).toBe('credit_limit');
      76 |       expect(getAttribute("maximum credit")).toBe('credit_limit');
    > 77 |       expect(getAttribute("max credit")).toBe('credit_limit');
         |                                          ^
      78 |     });
      79 |
      80 |     test('extracts annual_fee', () => {

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:77:42)

  â— Field Extraction - extractAttribute â€º Date/Time Fields â€º extracts due_date

    expect(received).toBe(expected) // Object.is equality

    Expected: "due_date"
    Received: null

       98 |       expect(getAttribute("due date")).toBe('due_date');
       99 |       expect(getAttribute("when due")).toBe('due_date');
    > 100 |       expect(getAttribute("payment due")).toBe('due_date');
          |                                           ^
      101 |     });
      102 |
      103 |     test('extracts statement_close', () => {

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:100:43)

  â— Field Extraction - extractAttribute â€º Rewards Fields â€º extracts rewards

    expect(received).toBe(expected) // Object.is equality

    Expected: "rewards"
    Received: null

      144 |       expect(getAttribute("show me points")).toBe('rewards');
      145 |       expect(getAttribute("cashback rate")).toBe('rewards');
    > 146 |       expect(getAttribute("how much can I earn")).toBe('rewards');
          |                                                   ^
      147 |       // "miles earning" may not trigger rewards attribute (earn might not match pattern)
      148 |       // Check if it extracts or not - both are acceptable
      149 |       const attr = getAttribute("miles earning");

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:146:51)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

FAIL __tests__/unit/fieldMapping.test.js (5.707 s)
  Field Mapping - QueryDecomposer._mapField
    Identity Fields Mapping
      âœ• maps issuer variations to issuer (890 ms)
      âœ• maps card_network variations to card_network (124 ms)
      âœ• maps card_type variations to card_type (59 ms)
      âœ• maps card_name variations to card_name (9 ms)
    Financial Fields Mapping
      âœ• maps balance variations to current_balance (11 ms)
      âœ• maps apr variations to apr (9 ms)
      âœ• maps credit_limit variations to credit_limit (11 ms)
      âœ• maps annual_fee variations to annual_fee (46 ms)
    Date Fields Mapping
      âœ• maps due_date variations correctly (39 ms)
      âœ• maps statement_close variations correctly (28 ms)
      âœ• maps grace_period variations to grace_period_days (52 ms)
    Computed Fields Mapping
      âœ• maps utilization variations to utilization (33 ms)
      âœ• maps available_credit variations to available_credit (47 ms)
    Aggregation Field Mapping
      âœ• maps balance in aggregations to current_balance (7 ms)
      âœ• maps apr in aggregations to apr (68 ms)
      âœ• maps credit_limit in aggregations to credit_limit (8 ms)
    Distinct Query Field Mapping
      âœ“ maps issuer in distinct queries (29 ms)
      âœ“ maps network in distinct queries (52 ms)
    Unknown Fields
      âœ“ handles unmapped fields gracefully (15 ms)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps issuer variations to issuer

    expect(received).toBe(expected) // Object.is equality

    Expected: "issuer"
    Received: undefined

      50 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      51 |       
    > 52 |       expect(structured.grouping).toBe('issuer');
         |                                   ^
      53 |     });
      54 |
      55 |     test('maps card_network variations to card_network', () => {

      at Object.toBe (__tests__/unit/fieldMapping.test.js:52:35)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps card_network variations to card_network

    expect(received).toBe(expected) // Object.is equality

    Expected: "card_network"
    Received: undefined

      59 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      60 |       
    > 61 |       expect(structured.grouping).toBe('card_network');
         |                                   ^
      62 |     });
      63 |
      64 |     test('maps card_type variations to card_type', () => {

      at Object.toBe (__tests__/unit/fieldMapping.test.js:61:35)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps card_type variations to card_type

    expect(received).toBe(expected) // Object.is equality

    Expected: "card_type"
    Received: undefined

      68 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      69 |       
    > 70 |       expect(structured.grouping).toBe('card_type');
         |                                   ^
      71 |     });
      72 |
      73 |     test('maps card_name variations to card_name', () => {

      at Object.toBe (__tests__/unit/fieldMapping.test.js:70:35)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps card_name variations to card_name

    expect(received).toBeTruthy()

    Received: null

      79 |       
      80 |       // card_name sorting is less common, but should map correctly
    > 81 |       expect(structured.sorting?.field || null).toBeTruthy();
         |                                                 ^
      82 |     });
      83 |   });
      84 |

      at Object.toBeTruthy (__tests__/unit/fieldMapping.test.js:81:49)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps balance variations to current_balance

    TypeError: Cannot read properties of undefined (reading 'field')

      91 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      92 |       
    > 93 |       expect(structured.sorting.field).toBe('current_balance');
         |                                 ^
      94 |     });
      95 |
      96 |     test('maps apr variations to apr', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:93:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps apr variations to apr

    TypeError: Cannot read properties of undefined (reading 'field')

      101 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      102 |       
    > 103 |       expect(structured.sorting.field).toBe('apr');
          |                                 ^
      104 |     });
      105 |
      106 |     test('maps credit_limit variations to credit_limit', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:103:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps credit_limit variations to credit_limit

    TypeError: Cannot read properties of undefined (reading 'field')

      111 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      112 |       
    > 113 |       expect(structured.sorting.field).toBe('credit_limit');
          |                                 ^
      114 |     });
      115 |
      116 |     test('maps annual_fee variations to annual_fee', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:113:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps annual_fee variations to annual_fee

    TypeError: Cannot read properties of undefined (reading 'field')

      121 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      122 |       
    > 123 |       expect(structured.sorting.field).toBe('annual_fee');
          |                                 ^
      124 |     });
      125 |   });
      126 |

      at Object.field (__tests__/unit/fieldMapping.test.js:123:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Date Fields Mapping â€º maps due_date variations correctly

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["payment_due_date", "payment_due_day"]

      133 |       
      134 |       // Should map to payment_due_date or payment_due_day
    > 135 |       expect(['payment_due_date', 'payment_due_day']).toContain(structured.sorting?.field || null);
          |                                                       ^
      136 |     });
      137 |
      138 |     test('maps statement_close variations correctly', () => {

      at Object.toContain (__tests__/unit/fieldMapping.test.js:135:55)

  â— Field Mapping - QueryDecomposer._mapField â€º Date Fields Mapping â€º maps statement_close variations correctly

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["statement_cycle_end", "statement_close_day"]

      143 |       
      144 |       // Should map to statement_cycle_end or statement_close_day
    > 145 |       expect(['statement_cycle_end', 'statement_close_day']).toContain(structured.sorting?.field || null);
          |                                                              ^
      146 |     });
      147 |
      148 |     test('maps grace_period variations to grace_period_days', () => {

      at Object.toContain (__tests__/unit/fieldMapping.test.js:145:62)

  â— Field Mapping - QueryDecomposer._mapField â€º Date Fields Mapping â€º maps grace_period variations to grace_period_days

    TypeError: Cannot read properties of undefined (reading 'field')

      153 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      154 |       
    > 155 |       expect(structured.sorting.field).toBe('grace_period_days');
          |                                 ^
      156 |     });
      157 |   });
      158 |

      at Object.field (__tests__/unit/fieldMapping.test.js:155:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Computed Fields Mapping â€º maps utilization variations to utilization

    TypeError: Cannot read properties of undefined (reading 'field')

      165 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      166 |       
    > 167 |       expect(structured.sorting.field).toBe('utilization');
          |                                 ^
      168 |     });
      169 |
      170 |     test('maps available_credit variations to available_credit', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:167:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Computed Fields Mapping â€º maps available_credit variations to available_credit

    TypeError: Cannot read properties of undefined (reading 'field')

      175 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      176 |       
    > 177 |       expect(structured.sorting.field).toBe('available_credit');
          |                                 ^
      178 |     });
      179 |   });
      180 |

      at Object.field (__tests__/unit/fieldMapping.test.js:177:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Aggregation Field Mapping â€º maps balance in aggregations to current_balance

    TypeError: Cannot read properties of undefined (reading '0')

      186 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      187 |       
    > 188 |       expect(structured.aggregations[0].field).toBe('current_balance');
          |                                     ^
      189 |     });
      190 |
      191 |     test('maps apr in aggregations to apr', () => {

      at Object.<anonymous> (__tests__/unit/fieldMapping.test.js:188:37)

  â— Field Mapping - QueryDecomposer._mapField â€º Aggregation Field Mapping â€º maps apr in aggregations to apr

    TypeError: Cannot read properties of undefined (reading '0')

      195 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      196 |       
    > 197 |       expect(structured.aggregations[0].field).toBe('apr');
          |                                     ^
      198 |     });
      199 |
      200 |     test('maps credit_limit in aggregations to credit_limit', () => {

      at Object.<anonymous> (__tests__/unit/fieldMapping.test.js:197:37)

  â— Field Mapping - QueryDecomposer._mapField â€º Aggregation Field Mapping â€º maps credit_limit in aggregations to credit_limit

    TypeError: Cannot read properties of undefined (reading '0')

      204 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      205 |       
    > 206 |       expect(structured.aggregations[0].field).toBe('credit_limit');
          |                                     ^
      207 |     });
      208 |   });
      209 |

      at Object.<anonymous> (__tests__/unit/fieldMapping.test.js:206:37)

FAIL __tests__/unit/endToEndFieldMapping.test.js (5.887 s)
  End-to-End Field Mapping
    Financial Fields End-to-End
      âœ• balance query extracts and maps correctly (937 ms)
      âœ• APR query extracts and maps correctly (98 ms)
      âœ• credit_limit query extracts and maps correctly (45 ms)
      âœ• annual_fee query extracts and maps correctly (16 ms)
      âœ• total balance aggregation extracts and maps correctly (53 ms)
    Identity Fields End-to-End
      âœ• issuer distinct query extracts and maps correctly (69 ms)
      âœ• card_network distinct query extracts and maps correctly (65 ms)
      âœ• issuer filter extracts and maps correctly (33 ms)
      âœ• network filter extracts and maps correctly (54 ms)
    Date Fields End-to-End
      âœ• due_date query extracts and maps correctly (22 ms)
      âœ• grace_period query extracts and maps correctly (106 ms)
    Computed Fields End-to-End
      âœ• utilization query extracts and maps correctly (32 ms)
      âœ• available_credit query extracts and maps correctly (13 ms)
    Balance Filter End-to-End
      âœ• with_balance filter extracts and filters correctly (51 ms)
      âœ• zero_balance filter extracts and filters correctly (68 ms)
    Grouped Aggregation End-to-End
      âœ• total balance by issuer extracts and maps correctly (10 ms)
    Complex Queries End-to-End
      âœ• compound filter with balance and APR extracts correctly (58 ms)
      âœ• distinct issuers with balance filter extracts correctly (64 ms)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º balance query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      106 |
      107 |       expect(entities.attribute).toBe('balance');
    > 108 |       expect(structured.sorting.field).toBe('current_balance');
          |                                 ^
      109 |       expect(results.results).toBeDefined();
      110 |       expect(Array.isArray(results.results)).toBe(true);
      111 |       

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:108:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º APR query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      125 |
      126 |       expect(entities.attribute).toBe('apr');
    > 127 |       expect(structured.sorting.field).toBe('apr');
          |                                 ^
      128 |       expect(results.results).toBeDefined();
      129 |       
      130 |       // Results should be sorted by APR (ascending for lowest)

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:127:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º credit_limit query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      141 |
      142 |       expect(entities.attribute).toBe('credit_limit');
    > 143 |       expect(structured.sorting.field).toBe('credit_limit');
          |                                 ^
      144 |       expect(results.results).toBeDefined();
      145 |     });
      146 |

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:143:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º annual_fee query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      152 |
      153 |       expect(entities.attribute).toBe('annual_fee');
    > 154 |       expect(structured.sorting.field).toBe('annual_fee');
          |                                 ^
      155 |       expect(results.results).toBeDefined();
      156 |     });
      157 |

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:154:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º total balance aggregation extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'length')

      163 |
      164 |       // Should aggregate on current_balance
    > 165 |       if (structured.aggregations.length > 0) {
          |                                   ^
      166 |         expect(structured.aggregations[0].field).toBe('current_balance');
      167 |         expect(structured.aggregations[0].operation).toBe('sum');
      168 |       }

      at Object.length (__tests__/unit/endToEndFieldMapping.test.js:165:35)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º issuer distinct query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      179 |
      180 |       expect(entities.distinctQuery).toBeDefined();
    > 181 |       expect(structured.distinct.field).toBe('issuer');
          |                                  ^
      182 |       expect(results.values).toBeDefined();
      183 |       
      184 |       // Should return distinct issuers

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:181:34)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º card_network distinct query extracts and maps correctly

    expect(received).toBeDefined()

    Received: undefined

      193 |       const results = executor.execute(structured);
      194 |
    > 195 |       expect(structured.distinct).toBeDefined();
          |                                   ^
      196 |       expect(structured.distinct.field).toBe('card_network');
      197 |       expect(results.values).toBeDefined();
      198 |     });

      at Object.toBeDefined (__tests__/unit/endToEndFieldMapping.test.js:195:35)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º issuer filter extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      205 |
      206 |       // Should filter by issuer
    > 207 |       const issuerFilter = structured.filters.find(f => f.field === 'issuer');
          |                                               ^
      208 |       if (issuerFilter) {
      209 |         expect(issuerFilter.field).toBe('issuer');
      210 |         expect(issuerFilter.value).toBe('Chase');

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:207:47)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º network filter extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      220 |
      221 |       // Should filter by card_network
    > 222 |       const networkFilter = structured.filters.find(f => f.field === 'card_network');
          |                                                ^
      223 |       if (networkFilter) {
      224 |         expect(networkFilter.field).toBe('card_network');
      225 |       }

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:222:48)

  â— End-to-End Field Mapping â€º Date Fields End-to-End â€º due_date query extracts and maps correctly

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["payment_due_date", "payment_due_day"]

      237 |       expect(entities.attribute).toBe('due_date');
      238 |       // Should map to payment_due_date or payment_due_day
    > 239 |       expect(['payment_due_date', 'payment_due_day']).toContain(structured.sorting?.field || null);
          |                                                       ^
      240 |       expect(results.results).toBeDefined();
      241 |     });
      242 |

      at Object.toContain (__tests__/unit/endToEndFieldMapping.test.js:239:55)

  â— End-to-End Field Mapping â€º Date Fields End-to-End â€º grace_period query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      248 |
      249 |       expect(entities.attribute).toBe('grace_period');
    > 250 |       expect(structured.sorting.field).toBe('grace_period_days');
          |                                 ^
      251 |       expect(results.results).toBeDefined();
      252 |     });
      253 |   });

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:250:33)

  â— End-to-End Field Mapping â€º Computed Fields End-to-End â€º utilization query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      261 |
      262 |       expect(entities.attribute).toBe('utilization');
    > 263 |       expect(structured.sorting.field).toBe('utilization');
          |                                 ^
      264 |       expect(results.results).toBeDefined();
      265 |     });
      266 |

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:263:33)

  â— End-to-End Field Mapping â€º Computed Fields End-to-End â€º available_credit query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      272 |
      273 |       expect(entities.attribute).toBe('available_credit');
    > 274 |       expect(structured.sorting.field).toBe('available_credit');
          |                                 ^
      275 |       expect(results.results).toBeDefined();
      276 |     });
      277 |   });

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:274:33)

  â— End-to-End Field Mapping â€º Balance Filter End-to-End â€º with_balance filter extracts and filters correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      285 |
      286 |       expect(entities.balanceFilter).toBe('with_balance');
    > 287 |       const balanceFilter = structured.filters.find(f => f.field === 'current_balance');
          |                                                ^
      288 |       expect(balanceFilter).toBeDefined();
      289 |       expect(balanceFilter.operator).toBe('>');
      290 |       expect(balanceFilter.value).toBe(0);

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:287:48)

  â— End-to-End Field Mapping â€º Balance Filter End-to-End â€º zero_balance filter extracts and filters correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      303 |
      304 |       expect(entities.balanceFilter).toBe('zero_balance');
    > 305 |       const balanceFilter = structured.filters.find(f => f.field === 'current_balance');
          |                                                ^
      306 |       expect(balanceFilter).toBeDefined();
      307 |       expect(balanceFilter.operator).toBe('==');
      308 |       expect(balanceFilter.value).toBe(0);

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:305:48)

  â— End-to-End Field Mapping â€º Grouped Aggregation End-to-End â€º total balance by issuer extracts and maps correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "issuer"
    Received: undefined

      323 |
      324 |       expect(entities.grouping).toBeDefined();
    > 325 |       expect(structured.grouping).toBe('issuer');
          |                                   ^
      326 |       expect(structured.aggregations[0].field).toBe('current_balance');
      327 |       expect(structured.aggregations[0].operation).toBe('sum');
      328 |       expect(results.results).toBeDefined();

      at Object.toBe (__tests__/unit/endToEndFieldMapping.test.js:325:35)

  â— End-to-End Field Mapping â€º Complex Queries End-to-End â€º compound filter with balance and APR extracts correctly

    TypeError: Cannot read properties of undefined (reading 'length')

      344 |       const results = executor.execute(structured);
      345 |
    > 346 |       expect(structured.filters.length).toBeGreaterThan(0);
          |                                 ^
      347 |       expect(results.results).toBeDefined();
      348 |       
      349 |       // Verify filters are applied correctly

      at Object.length (__tests__/unit/endToEndFieldMapping.test.js:346:33)

  â— End-to-End Field Mapping â€º Complex Queries End-to-End â€º distinct issuers with balance filter extracts correctly

    expect(received).toBeDefined()

    Received: undefined

      364 |       const results = executor.execute(structured);
      365 |
    > 366 |       expect(structured.distinct).toBeDefined();
          |                                   ^
      367 |       expect(structured.distinct.field).toBe('issuer');
      368 |       expect(structured.filters.length).toBeGreaterThan(0);
      369 |       expect(results.values).toBeDefined();

      at Object.toBeDefined (__tests__/unit/endToEndFieldMapping.test.js:366:35)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)

FAIL __tests__/unit/userEnteredFields.test.js (6.443 s)
  User-Entered Card Fields - Extraction Tests
    1. IDENTITY FIELDS
      1.1 card_name (Required for manual entry)
        âœ“ extracts from "what is the name of my card" (336 ms)
        âœ“ extracts from "show me card name" (86 ms)
        âœ• extracts from "what card is this" (9 ms)
        âœ“ extracts from "card title" (12 ms)
      1.2 nickname (Optional user-friendly name)
        âœ• extracts from "what is my card nickname" (23 ms)
        âœ“ extracts from "show me nickname" (4 ms)
        âœ“ extracts from "card alias" (3 ms)
        âœ• extracts from "what did I name this card" (42 ms)
      1.3 issuer (Optional for manual entry)
        âœ“ extracts from "what is the issuer" (4 ms)
        âœ“ extracts from "which bank" (5 ms)
        âœ“ extracts from "show me bank" (5 ms)
        âœ“ distinct query: "what are the different issuers" (15 ms)
      1.4 card_network (Visa/Mastercard/Amex/Discover)
        âœ“ extracts from "what network is this card" (4 ms)
        âœ“ extracts from "show me card network" (5 ms)
        âœ“ distinct query: "what networks do I have" (30 ms)
        âœ“ filter query: "show me visa cards" (9 ms)
    2. FINANCIAL FIELDS
      2.1 credit_limit (Required)
        âœ“ extracts from "what is my credit limit" (5 ms)
        âœ“ extracts from "show me limit" (26 ms)
        âœ“ extracts from "maximum credit" (4 ms)
        âœ“ comparison query: "cards with highest credit limit" (3 ms)
        âœ“ aggregation query: "total credit limit" (32 ms)
      2.2 current_balance (Optional)
        âœ“ extracts from "what is my balance" (4 ms)
        âœ“ extracts from "current balance" (4 ms)
        âœ“ extracts from "how much do I owe" (14 ms)
        âœ“ extracts from "debt" (9 ms)
        âœ“ comparison query: "cards with highest balance" (38 ms)
        âœ“ aggregation query: "total balance" (6 ms)
        âœ“ filter query: "list cards with balance" (5 ms)
        âœ“ filter query: "cards with zero balance" (16 ms)
      2.3 apr (Annual Percentage Rate)
        âœ“ extracts from "what is my APR" (3 ms)
        âœ“ extracts from "interest rate" (2 ms)
        âœ“ extracts from "annual percentage rate" (22 ms)
        âœ“ comparison query: "cards with lowest APR" (9 ms)
        âœ“ aggregation query: "average APR" (3 ms)
      2.4 amount_to_pay (Optional - minimum payment due)
        âœ“ extracts from "payment amount" (7 ms)
        âœ“ extracts from "how much should I pay" (47 ms)
        âœ“ extracts from "minimum payment" (3 ms)
        âœ“ extracts from "amount to pay" (2 ms)
        âœ“ listing query: "show payment amounts" (2 ms)
      2.5 annual_fee (Optional for manual entry)
        âœ“ extracts from "annual fee" (3 ms)
        âœ“ extracts from "yearly fee" (5 ms)
        âœ“ extracts from "show me fee" (9 ms)
        âœ“ comparison query: "cards with lowest annual fee" (31 ms)
    3. DATE/TIME FIELDS
      3.1 payment_due_date / payment_due_day (Day of month)
        âœ“ extracts from "when is payment due" (3 ms)
        âœ“ extracts from "payment due date" (2 ms)
        âœ“ extracts from "due date" (22 ms)
        âœ“ extracts from "when due" (11 ms)
        âœ“ listing query: "show due dates" (3 ms)
      3.2 statement_close_date / statement_close_day (Day of month)
        âœ“ extracts from "when does statement close" (4 ms)
        âœ“ extracts from "statement end date" (4 ms)
        âœ“ extracts from "statement cycle end" (2 ms)
        âœ“ extracts from "close date" (2 ms)
      3.3 grace_period_days (Calculated)
        âœ“ extracts from "grace period" (6 ms)
        âœ“ extracts from "grace days" (34 ms)
        âœ“ extracts from "interest free days" (8 ms)
        âœ“ comparison query: "cards with longest grace period" (12 ms)
    4. COMPUTED FIELDS (Derived from user-entered data)
      4.1 utilization (current_balance / credit_limit)
        âœ“ extracts from "utilization" (36 ms)
        âœ“ extracts from "credit usage" (6 ms)
        âœ“ comparison query: "cards with highest utilization" (3 ms)
      4.2 available_credit (credit_limit - current_balance)
        âœ“ extracts from "available credit" (5 ms)
        âœ“ extracts from "how much available" (3 ms)
        âœ“ extracts from "can I spend" (3 ms)
        âœ“ comparison query: "cards with most available credit" (3 ms)
    5. REWARD FIELDS (Manual entry - reward_structure JSONB)
      âœ“ extracts from "rewards" (5 ms)
      âœ“ extracts from "points" (2 ms)
      âœ“ extracts from "cashback" (2 ms)
      âœ“ category-specific: "dining rewards" (2 ms)
    6. END-TO-END QUERIES FOR ALL USER-ENTERED FIELDS
      âœ“ card_name: "what is the name of my card" â†’ extracts and queries (917 ms)
      âœ• nickname: "what is my card nickname" â†’ extracts and queries (16 ms)
      âœ“ credit_limit: "what is my credit limit" â†’ extracts and queries (8 ms)
      âœ“ current_balance: "what is my balance" â†’ extracts and queries (12 ms)
      âœ“ apr: "what is my APR" â†’ extracts and queries (48 ms)
      âœ“ amount_to_pay: "payment amount" â†’ extracts and queries (11 ms)
      âœ“ annual_fee: "annual fee" â†’ extracts and queries (7 ms)
      âœ“ due_date: "when is payment due" â†’ extracts and queries (5 ms)
      âœ“ statement_close: "when does statement close" â†’ extracts and queries (59 ms)
      âœ“ grace_period: "grace period" â†’ extracts and queries (12 ms)
      âœ“ utilization: "utilization" â†’ extracts and queries (22 ms)
      âœ“ available_credit: "available credit" â†’ extracts and queries (8 ms)
    7. REALISTIC USER QUERY PATTERNS
      âœ“ "show me my credit limits" - lists all credit limits (21 ms)
      âœ“ "which card has the lowest APR" - comparison query (43 ms)
      âœ“ "total balance across all cards" - aggregation query (3 ms)
      âœ“ "when are my payments due" - timeframe query (6 ms)
      âœ“ "list cards with balances" - filter + listing query (5 ms)
      âœ“ "what are the different issuers in my wallet" - distinct query (5 ms)

  â— User-Entered Card Fields - Extraction Tests â€º 1. IDENTITY FIELDS â€º 1.1 card_name (Required for manual entry) â€º extracts from "what card is this"

    expect(received).toBeTruthy()

    Received: null

      90 |         // It's more of a general listing query
      91 |         const entities = extractEntities(query);
    > 92 |         expect(entities.queryType).toBeTruthy();
         |                                    ^
      93 |       });
      94 |
      95 |       test('extracts from "card title"', () => {

      at Object.toBeTruthy (__tests__/unit/userEnteredFields.test.js:92:36)

  â— User-Entered Card Fields - Extraction Tests â€º 1. IDENTITY FIELDS â€º 1.2 nickname (Optional user-friendly name) â€º extracts from "what is my card nickname"

    expect(received).toBe(expected) // Object.is equality

    Expected: "nickname"
    Received: "card_name"

      102 |       test('extracts from "what is my card nickname"', () => {
      103 |         const query = "what is my card nickname";
    > 104 |         expect(getAttribute(query)).toBe('nickname');
          |                                     ^
      105 |       });
      106 |
      107 |       test('extracts from "show me nickname"', () => {

      at Object.toBe (__tests__/unit/userEnteredFields.test.js:104:37)

  â— User-Entered Card Fields - Extraction Tests â€º 1. IDENTITY FIELDS â€º 1.2 nickname (Optional user-friendly name) â€º extracts from "what did I name this card"

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["nickname", "card_name"]

      119 |         // Should extract nickname or card_name
      120 |         const entities = extractEntities(query);
    > 121 |         expect(['nickname', 'card_name']).toContain(entities.attribute);
          |                                           ^
      122 |       });
      123 |     });
      124 |

      at Object.toContain (__tests__/unit/userEnteredFields.test.js:121:43)

  â— User-Entered Card Fields - Extraction Tests â€º 6. END-TO-END QUERIES FOR ALL USER-ENTERED FIELDS â€º nickname: "what is my card nickname" â†’ extracts and queries

    expect(received).toBe(expected) // Object.is equality

    Expected: "nickname"
    Received: "card_name"

      524 |       const results = executor.execute(structured);
      525 |
    > 526 |       expect(entities.attribute).toBe('nickname');
          |                                  ^
      527 |       expect(results).toBeDefined();
      528 |     });
      529 |

      at Object.toBe (__tests__/unit/userEnteredFields.test.js:526:34)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)
        at handleCardDataQueryPhase3 (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:701:29)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:265:24)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)
      at handleCardDataQueryPhase3 (services/chat/cardDataQueryHandler.js:701:29)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:265:24)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)
        at handleCardDataQueryPhase3 (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:701:29)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:265:24)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)
      at handleCardDataQueryPhase3 (services/chat/cardDataQueryHandler.js:701:29)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:265:24)

PASS __tests__/unit/entityExtractorPhase2.test.js
  Entity Extractor - Phase 2: Query System Entities
    Distinct Query Detection
      âœ“ detects distinct query for issuers (529 ms)
      âœ“ detects distinct query for networks (65 ms)
      âœ“ detects distinct query with "different" keyword (8 ms)
      âœ“ detects distinct query with "various" keyword (47 ms)
      âœ“ detects distinct query with "all the" keyword (39 ms)
      âœ“ detects distinct query with "how many different" (7 ms)
      âœ“ detects distinct query with breakdown (56 ms)
      âœ“ detects distinct query with distribution (22 ms)
      âœ“ defaults to issuer field when field not detected (5 ms)
      âœ“ returns null for non-distinct queries (27 ms)
      âœ“ detects distinct query with case variations (48 ms)
    Compound Operator Detection
      âœ“ detects AND operator (16 ms)
      âœ“ detects multiple AND operators (7 ms)
      âœ“ detects OR operator (5 ms)
      âœ“ detects multiple OR operators (86 ms)
      âœ“ infers AND for implicit compound conditions (12 ms)
      âœ“ returns empty array for single condition queries (6 ms)
      âœ“ detects AND with comma separation (4 ms)
    Grouping Detection
      âœ“ detects grouping by issuer (4 ms)
      âœ“ detects grouping by network (13 ms)
      âœ“ detects grouping with "by" keyword (4 ms)
      âœ“ detects grouping with "grouped by" (28 ms)
      âœ“ detects grouping with "breakdown by" (8 ms)
      âœ“ detects grouping with "distribution by" (5 ms)
      âœ“ returns null for non-grouping queries (4 ms)
    Aggregation Operation Detection
      âœ“ detects sum aggregation (5 ms)
      âœ“ detects sum with "add up" (6 ms)
      âœ“ detects average aggregation (10 ms)
      âœ“ detects count aggregation (5 ms)
      âœ“ detects count with "number of" (5 ms)
      âœ“ detects min aggregation (4 ms)
      âœ“ detects max aggregation (6 ms)
      âœ“ detects max with "highest" (9 ms)
      âœ“ returns null for field when not specified (3 ms)
      âœ“ returns null for non-aggregation queries (113 ms)
    Combined Phase 2 Entities
      âœ“ detects distinct query with grouping (3 ms)
      âœ“ detects aggregation with grouping (10 ms)
      âœ“ detects distinct query with compound filters (21 ms)
      âœ“ detects aggregation with distinct query (4 ms)
      âœ“ complex query: distinct with grouping and aggregation (5 ms)
    Edge Cases
      âœ“ handles empty query (64 ms)
      âœ“ handles query with multiple distinct keywords (4 ms)
      âœ“ handles ambiguous queries (5 ms)
      âœ“ handles case insensitive queries (35 ms)

PASS __tests__/unit/allCategoriesExtraction.test.js
  Category Extraction - All 14 Categories
    Dining Category
      âœ“ extracts "dining" from "best card for dining" (435 ms)
      âœ“ extracts "dining" from "restaurant" keyword (37 ms)
      âœ“ extracts "dining" from "eating out" (69 ms)
      âœ“ extracts "dining" from "takeout" (10 ms)
    Groceries Category
      âœ“ extracts "groceries" from "best card for groceries" (12 ms)
      âœ“ extracts "groceries" from "grocery store" (5 ms)
      âœ“ extracts "groceries" from "supermarket" (3 ms)
      âœ“ extracts "groceries" from "food shopping" (not dining) (4 ms)
    Gas Category
      âœ“ extracts "gas" from "best card for gas" (6 ms)
      âœ“ extracts "gas" from "gas station" (4 ms)
      âœ“ extracts "gas" from "fuel" (4 ms)
      âœ“ extracts "gas" from "ev charging" (4 ms)
    Travel Category
      âœ“ extracts "travel" from "best card for travel" (109 ms)
      âœ“ extracts "travel" from "flight" (6 ms)
      âœ“ extracts "travel" from "hotel" (3 ms)
      âœ“ extracts "travel" from "vacation" (8 ms)
      âœ“ extracts "travel" from "airbnb" (4 ms)
      âœ“ extracts "travel" from "cruise" (3 ms)
    Entertainment Category
      âœ“ extracts "entertainment" from "best card for entertainment" (37 ms)
      âœ“ extracts "entertainment" from "movies" (3 ms)
      âœ“ extracts "entertainment" from "concert" (3 ms)
      âœ“ extracts "entertainment" from "theater" (15 ms)
      âœ“ extracts "entertainment" from "event tickets" (2 ms)
    Streaming Category
      âœ“ extracts "streaming" from "best card for streaming" (3 ms)
      âœ“ extracts "streaming" from "streaming services" (5 ms)
      âœ“ extracts "streaming" from "subscriptions" (3 ms)
      âœ“ extracts "streaming" from "netflix" (3 ms)
      âœ“ extracts "streaming" from "spotify" (5 ms)
      âœ“ extracts "streaming" from "disney plus" (62 ms)
    Drugstores Category
      âœ“ extracts "drugstores" from "best card for drugstores" (13 ms)
      âœ“ extracts "drugstores" from "pharmacy" (6 ms)
      âœ“ extracts "drugstores" from "cvs" (6 ms)
      âœ“ extracts "drugstores" from "walgreens" (46 ms)
      âœ“ extracts "drugstores" from "drug store" (3 ms)
    Home Improvement Category
      âœ“ extracts "home_improvement" from "best card for home improvement" (3 ms)
      âœ“ extracts "home_improvement" from "hardware" (35 ms)
      âœ“ extracts "home_improvement" from "home depot" (6 ms)
      âœ“ extracts "home_improvement" from "lowes" (7 ms)
      âœ“ extracts "home_improvement" from "hardware store" (7 ms)
    Department Stores Category
      âœ“ extracts "department_stores" from "best card for department store" (2 ms)
      âœ“ extracts "department_stores" from "shopping" (2 ms)
      âœ“ extracts "department_stores" from "shopping mall" (19 ms)
      âœ“ extracts "department_stores" from "mall" (4 ms)
      âœ“ extracts "department_stores" from "retail store" (4 ms)
    Transit Category
      âœ“ extracts "transit" from "best card for transit" (32 ms)
      âœ“ extracts "transit" from "public transit" (3 ms)
      âœ“ extracts "transit" from "uber" (11 ms)
      âœ“ extracts "transit" from "lyft" (33 ms)
      âœ“ extracts "transit" from "taxi" (15 ms)
      âœ“ extracts "transit" from "rideshare" (3 ms)
      âœ“ extracts "transit" from "subway" (48 ms)
    Utilities Category
      âœ“ extracts "utilities" from "best card for utilities" (4 ms)
      âœ“ extracts "utilities" from "electricity" (5 ms)
      âœ“ extracts "utilities" from "electric bill" (9 ms)
      âœ“ extracts "utilities" from "water bill" (5 ms)
      âœ“ extracts "utilities" from "internet bill" (2 ms)
      âœ“ extracts "utilities" from "phone bill" (40 ms)
      âœ“ extracts "utilities" from "cable bill" (3 ms)
    Warehouse Category
      âœ“ extracts "warehouse" from "best card for warehouse" (2 ms)
      âœ“ extracts "warehouse" from "warehouse club" (32 ms)
      âœ“ extracts "warehouse" from "costco" (should NOT extract as merchant when used as category) (13 ms)
      âœ“ extracts "warehouse" from "sams club" (3 ms)
      âœ“ extracts "warehouse" from "wholesale club" (3 ms)
    Office Supplies Category
      âœ“ extracts "office_supplies" from "best card for office supplies" (9 ms)
      âœ“ extracts "office_supplies" from "office supply" (4 ms)
      âœ“ extracts "office_supplies" from "office depot" (2 ms)
      âœ“ extracts "office_supplies" from "staples" (75 ms)
      âœ“ extracts "office_supplies" from "stationery" (8 ms)
    Insurance Category
      âœ“ extracts "insurance" from "best card for insurance" (3 ms)
      âœ“ extracts "insurance" from "auto insurance" (6 ms)
      âœ“ extracts "insurance" from "car insurance" (4 ms)
      âœ“ extracts "insurance" from "health insurance" (3 ms)
      âœ“ extracts "insurance" from "home insurance" (31 ms)
      âœ“ extracts "insurance" from "life insurance" (2 ms)
    Category Extraction - Edge Cases
      âœ“ handles "best card for" prefix for all categories (165 ms)
      âœ“ handles "which card for" prefix (7 ms)
      âœ“ handles "suggest card for" prefix (4 ms)
      âœ“ handles category with amount (21 ms)
      âœ“ handles multiple category mentions (should use first match) (11 ms)
    Category Precedence
      âœ“ category takes precedence over merchant when both exist (3 ms)
      âœ“ longer category phrases match correctly (2 ms)
      âœ“ case insensitive matching (4 ms)

  console.error
    [QueryAnalytics] Error tracking query: TypeError: _supabase.supabase.from is not a function
        at QueryAnalytics.from [as trackQuery] (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/queryAnalytics.js:183:10)
        at QueryExecutor.trackQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryExecutor.js:180:31)
        at QueryExecutor.trackQuery [as execute] (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryExecutor.js:143:12)
        at execute (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:709:42)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:265:24)

      200 |       return data.id;
      201 |     } catch (error) {
    > 202 |       console.error('[QueryAnalytics] Error tracking query:', error);
          |               ^
      203 |       // Don't throw - analytics shouldn't break query execution
      204 |       return null;
      205 |     }

      at QueryAnalytics.error [as trackQuery] (services/chat/learning/queryAnalytics.js:202:15)
      at QueryExecutor.trackQuery (services/chat/query/queryExecutor.js:180:31)
      at QueryExecutor.trackQuery [as execute] (services/chat/query/queryExecutor.js:143:12)
      at execute (services/chat/cardDataQueryHandler.js:709:42)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:265:24)

  console.error
    [PatternLearner] Error finding similar pattern: TypeError: _supabase.supabase.from is not a function
        at PatternLearner.from [as _findSimilarPattern] (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:400:10)
        at PatternLearner._findSimilarPattern [as learnPattern] (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:71:42)
        at QueryDecomposer.learnPattern [as learnFromSuccess] (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:299:35)
        at learnFromSuccess (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:728:18)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:265:24)

      427 |       return bestMatch;
      428 |     } catch (error) {
    > 429 |       console.error('[PatternLearner] Error finding similar pattern:', error);
          |               ^
      430 |       return null;
      431 |     }
      432 |   }

      at PatternLearner.error [as _findSimilarPattern] (services/chat/learning/patternLearner.js:429:15)
      at PatternLearner._findSimilarPattern [as learnPattern] (services/chat/learning/patternLearner.js:71:42)
      at QueryDecomposer.learnPattern [as learnFromSuccess] (services/chat/query/queryDecomposer.js:299:35)
      at learnFromSuccess (services/chat/cardDataQueryHandler.js:728:18)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:265:24)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner._createPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:441:30)
        at PatternLearner.learnPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:78:16)
        at QueryDecomposer.learnFromSuccess (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:299:9)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner._createPattern (services/chat/learning/patternLearner.js:441:30)
      at PatternLearner.learnPattern (services/chat/learning/patternLearner.js:78:16)
      at QueryDecomposer.learnFromSuccess (services/chat/query/queryDecomposer.js:299:9)

  console.error
    [PatternLearner] Error creating pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner._createPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:441:30)
        at PatternLearner.learnPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:78:16)
        at QueryDecomposer.learnFromSuccess (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:299:9)

      525 |       return pattern;
      526 |     } catch (error) {
    > 527 |       console.error('[PatternLearner] Error creating pattern:', error);
          |               ^
      528 |       throw error;
      529 |     }
      530 |   }

      at PatternLearner.error [as _createPattern] (services/chat/learning/patternLearner.js:527:15)
      at PatternLearner.learnPattern (services/chat/learning/patternLearner.js:78:16)
      at QueryDecomposer.learnFromSuccess (services/chat/query/queryDecomposer.js:299:9)

  console.error
    [PatternLearner] Error learning pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner._createPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:441:30)
        at PatternLearner.learnPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:78:16)
        at QueryDecomposer.learnFromSuccess (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:299:9)

      79 |       }
      80 |     } catch (error) {
    > 81 |       console.error('[PatternLearner] Error learning pattern:', error);
         |               ^
      82 |       throw error;
      83 |     }
      84 |   }

      at PatternLearner.error [as learnPattern] (services/chat/learning/patternLearner.js:81:15)
      at QueryDecomposer.learnFromSuccess (services/chat/query/queryDecomposer.js:299:9)

  console.error
    [QueryDecomposer] Error learning from success: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner._createPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:441:30)
        at PatternLearner.learnPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:78:16)
        at QueryDecomposer.learnFromSuccess (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:299:9)

      308 |       }
      309 |     } catch (error) {
    > 310 |       console.error('[QueryDecomposer] Error learning from success:', error);
          |               ^
      311 |       // Don't throw - learning shouldn't break query execution
      312 |     }
      313 |   }

      at QueryDecomposer.error [as learnFromSuccess] (services/chat/query/queryDecomposer.js:310:15)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)
        at handleCardDataQueryPhase3 (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:701:29)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:278:24)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)
      at handleCardDataQueryPhase3 (services/chat/cardDataQueryHandler.js:701:29)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:278:24)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)
        at handleCardDataQueryPhase3 (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:701:29)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:278:24)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)
      at handleCardDataQueryPhase3 (services/chat/cardDataQueryHandler.js:701:29)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:278:24)

  console.error
    [CardDataQuery] Phase 3 error: TypeError: Converting circular structure to JSON
        --> starting at object with constructor 'Object'
        |     property 'previousQuery' -> object with constructor 'Object'
        --- property 'context' closes the circle
        at JSON.stringify (<anonymous>)
        at stringify (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:702:68)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:278:24)

      741 |     return null; // Fall back to legacy if response is empty
      742 |   } catch (error) {
    > 743 |     console.error('[CardDataQuery] Phase 3 error:', error);
          |             ^
      744 |     throw error; // Let caller handle fallback
      745 |   }
      746 | }

      at error (services/chat/cardDataQueryHandler.js:743:13)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:278:24)

  console.error
    [CardDataQuery] Phase 3 pipeline failed, falling back to legacy: TypeError: Converting circular structure to JSON
        --> starting at object with constructor 'Object'
        |     property 'previousQuery' -> object with constructor 'Object'
        --- property 'context' closes the circle
        at JSON.stringify (<anonymous>)
        at stringify (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:702:68)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:278:24)

      88 |       // If Phase 3 returns null/empty, fall through to legacy
      89 |     } catch (error) {
    > 90 |       console.error('[CardDataQuery] Phase 3 pipeline failed, falling back to legacy:', error);
         |               ^
      91 |       // Fall through to legacy handlers
      92 |     }
      93 |   }

      at error (services/chat/cardDataQueryHandler.js:90:15)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:278:24)

  console.error
    [EmbeddingService] Error generating embedding: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)
        at handleCardDataQueryPhase3 (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:701:29)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:289:24)

      42 |
      43 |   } catch (error) {
    > 44 |     console.error('[EmbeddingService] Error generating embedding:', error);
         |             ^
      45 |     throw error;
      46 |   }
      47 | }

      at error (services/embedding/embeddingService.js:44:13)
      at PatternLearner.findMatchingPattern (services/chat/learning/patternLearner.js:107:30)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)
      at handleCardDataQueryPhase3 (services/chat/cardDataQueryHandler.js:701:29)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:289:24)

  console.error
    [PatternLearner] Error finding matching pattern: TypeError: Cannot read properties of undefined (reading '0')
        at getEmbedding (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/embedding/embeddingService.js:38:32)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at PatternLearner.findMatchingPattern (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/learning/patternLearner.js:107:30)
        at QueryDecomposer.decompose (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/query/queryDecomposer.js:184:33)
        at handleCardDataQueryPhase3 (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:701:29)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:289:24)

      179 |       };
      180 |     } catch (error) {
    > 181 |       console.error('[PatternLearner] Error finding matching pattern:', error);
          |               ^
      182 |       return null;
      183 |     }
      184 |   }

      at PatternLearner.error [as findMatchingPattern] (services/chat/learning/patternLearner.js:181:15)
      at QueryDecomposer.decompose (services/chat/query/queryDecomposer.js:184:33)
      at handleCardDataQueryPhase3 (services/chat/cardDataQueryHandler.js:701:29)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:289:24)

  console.error
    [CardDataQuery] Phase 3 error: TypeError: Converting circular structure to JSON
        --> starting at object with constructor 'Object'
        |     property 'previousQuery' -> object with constructor 'Object'
        --- property 'context' closes the circle
        at JSON.stringify (<anonymous>)
        at stringify (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:702:68)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:289:24)

      741 |     return null; // Fall back to legacy if response is empty
      742 |   } catch (error) {
    > 743 |     console.error('[CardDataQuery] Phase 3 error:', error);
          |             ^
      744 |     throw error; // Let caller handle fallback
      745 |   }
      746 | }

      at error (services/chat/cardDataQueryHandler.js:743:13)
      at handleCardDataQuery (services/chat/cardDataQueryHandler.js:84:30)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:289:24)

  console.error
    [CardDataQuery] Phase 3 pipeline failed, falling back to legacy: TypeError: Converting circular structure to JSON
        --> starting at object with constructor 'Object'
        |     property 'previousQuery' -> object with constructor 'Object'
        --- property 'context' closes the circle
        at JSON.stringify (<anonymous>)
        at stringify (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:702:68)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at handleCardDataQuery (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/chat/cardDataQueryHandler.js:84:30)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/query/phase3Integration.test.js:289:24)

      88 |       // If Phase 3 returns null/empty, fall through to legacy
      89 |     } catch (error) {
    > 90 |       console.error('[CardDataQuery] Phase 3 pipeline failed, falling back to legacy:', error);
         |               ^
      91 |       // Fall through to legacy handlers
      92 |     }
      93 |   }

      at error (services/chat/cardDataQueryHandler.js:90:15)
      at Object.<anonymous> (__tests__/unit/query/phase3Integration.test.js:289:24)

PASS __tests__/unit/query/phase3Integration.test.js
  Phase 3 Integration - Complete Pipeline
    End-to-End: Distinct Queries
      âœ“ complete pipeline: "what are the different issuers" (437 ms)
      âœ“ complete pipeline: "what networks do I have" (75 ms)
    End-to-End: Aggregation Queries
      âœ“ complete pipeline: "what is my total balance" (118 ms)
      âœ“ complete pipeline: "average APR" (28 ms)
    End-to-End: Grouped Aggregation Queries
      âœ“ complete pipeline: "total balance by issuer" (15 ms)
    End-to-End: Filter Queries
      âœ“ complete pipeline: "cards with balance" (64 ms)
      âœ“ complete pipeline: "zero balance cards" (8 ms)
    End-to-End: handleCardDataQuery Integration
      âœ“ handleCardDataQuery uses Phase 3 for distinct queries (872 ms)
      âœ“ handleCardDataQuery uses Phase 3 for aggregation queries (48 ms)
      âœ“ handleCardDataQuery uses Phase 3 for grouped aggregation (13 ms)
      âœ“ handleCardDataQuery falls back to legacy for simple queries (4 ms)
    Error Handling
      âœ“ handles empty card array gracefully (62 ms)
      âœ“ handles invalid structured query gracefully (3 ms)
    Realistic User Queries
      âœ“ "what are the different issuers in my wallet" (5 ms)
      âœ“ "show me visa cards" (56 ms)
      âœ“ "total balance across all cards" (4 ms)
      âœ“ "which card has the lowest APR" (4 ms)

PASS __tests__/unit/splitPayment.test.js
  Split Payment Handler
    Edge Cases
      âœ“ should return helpful message when no cards provided (2 ms)
      âœ“ should return helpful message when amount is missing (1 ms)
      âœ“ should return helpful message when all cards have zero balance (118 ms)
      âœ“ should handle zero balance with single card (1 ms)
    Minimum Payment Validation
      âœ“ should show partial split when budget less than minimum payments required (3 ms)
      âœ“ should accept budget equal to minimum payments (1 ms)
      âœ“ should handle minimum payment higher than balance (use balance as min) (1 ms)
    Payment Split Calculations
      âœ“ should split payment correctly with single card (60 ms)
      âœ“ should allocate minimum payments to all cards first (3 ms)
      âœ“ should distribute remaining budget based on APR (higher APR gets more) (1 ms)
      âœ“ should not exceed card balance when allocating (7 ms)
      âœ“ should handle cards with no minimum payment set (2 ms)
    Interest Savings Calculation
      âœ“ should calculate interest savings when payments exceed minimums (7 ms)
      âœ“ should not show interest savings when paying only minimums (1 ms)
    Response Format
      âœ“ should include markdown table with card details (2 ms)
      âœ“ should include totals and budget remaining (1 ms)
      âœ“ should include next steps section (2 ms)
      âœ“ should format currency correctly with commas and decimals (4 ms)
    Complex Scenarios
      âœ“ should handle multiple cards with varying balances and APRs (15 ms)
      âœ“ should prioritize high APR cards when distributing extra payments (4 ms)
      âœ“ should handle mixed cards with some at zero balance (12 ms)
      âœ“ should show ALL cards in split table including zero balance ones (3 ms)
    Nickname vs Card Name Handling
      âœ“ should prefer nickname over card_name when available (2 ms)
      âœ“ should fall back to card_name when nickname is missing (1 ms)

PASS __tests__/unit/entityExtractor.test.js
  Entity Extractor - Category Extraction
    âœ“ extracts "travel" category from "best card for travel" (143 ms)
    âœ“ extracts "travel" category from "suggest best card for travel" (9 ms)
    âœ“ extracts "travel" category from "which card for travel" (22 ms)
    âœ“ extracts "dining" category from "best card for dining" (3 ms)
    âœ“ extracts "groceries" category from "which card for groceries" (3 ms)
    âœ“ extracts "gas" category from "best card for gas" (3 ms)
    âœ“ extracts "travel" from "flight" keyword (4 ms)
    âœ“ extracts "travel" from "hotel" keyword (3 ms)
    âœ“ extracts "entertainment" category (67 ms)
    âœ“ extracts "streaming" category (3 ms)
  Entity Extractor - Category vs Merchant Precedence
    âœ“ category takes precedence over merchant when both match (3 ms)
    âœ“ merchant extraction works when no category matches (23 ms)
    âœ“ costco extracts as warehouse category (not merchant) (4 ms)
    âœ“ both category and merchant can be extracted for specific queries (3 ms)
  Entity Extractor - Reward Structure Matching
    âœ“ extracts category for reward optimization queries (14 ms)
    âœ“ extracts category with amount specified (3 ms)

PASS __tests__/unit/reminderService.test.js
  Reminder Service - In-memory fallback
    âœ“ upsertReminders stores reminders and returns sorted list (2 ms)
    âœ“ listReminders filters by time window and status
    âœ“ muteReminders marks subsequent reminders as muted
    âœ“ updateReminderStatus and snoozeReminder mutate stored reminder (8 ms)
    âœ“ deleteReminder removes reminder from store (1 ms)

PASS __tests__/unit/query/queryExecutor.test.js
  QueryExecutor
    Constructor
      âœ“ creates instance with cards array (2 ms)
      âœ“ throws error for non-array input (16 ms)
      âœ“ creates instance with context (117 ms)
    Execute Distinct Queries
      âœ“ executes distinct issuers query (177 ms)
      âœ“ executes distinct networks query (6 ms)
      âœ“ executes distinct query with balance filter (16 ms)
    Execute Aggregation Queries
      âœ“ executes sum aggregation query (20 ms)
      âœ“ executes average aggregation query (4 ms)
      âœ“ executes count aggregation query (5 ms)
      âœ“ executes grouped aggregation query (31 ms)
      âœ“ executes aggregation with filters (42 ms)
    Execute Filter Queries
      âœ“ executes filter query (8 ms)
      âœ“ executes compound filter query (22 ms)
      âœ“ executes query with balance filter (4 ms)
    Execute Batch Queries
      âœ“ executes multiple queries in parallel (17 ms)
      âœ“ throws error for non-array batch input (2 ms)
    Error Handling
      âœ“ throws error for missing structured query (2 ms)
      âœ“ throws error for invalid structured query (2 ms)
    Query Metadata
      âœ“ includes query metadata in results (31 ms)

PASS __tests__/unit/categoryDefinitions.test.js
  categoryDefinitions - Basic Structure
    âœ“ exports MERCHANT_CATEGORIES object (2 ms)
    âœ“ contains exactly 14 categories
    âœ“ all category IDs match object keys (3 ms)
    âœ“ all categories have required properties (30 ms)
    âœ“ all keywords are lowercase strings (178 ms)
    âœ“ all MCC codes are numbers (8 ms)
    âœ“ all reward aliases are lowercase strings (34 ms)
  categoryDefinitions - All 14 Categories Present
    âœ“ contains Dining category with correct data (1 ms)
    âœ“ contains Groceries category with correct data (3 ms)
    âœ“ contains Gas category with correct data (1 ms)
    âœ“ contains Travel category with correct data (2 ms)
    âœ“ contains Entertainment category with correct data
    âœ“ contains Streaming category with correct data (1 ms)
    âœ“ contains Drugstores category with correct data (3 ms)
    âœ“ contains Home Improvement category with correct data (1 ms)
    âœ“ contains Department Stores category with correct data (1 ms)
    âœ“ contains Transit category with correct data (1 ms)
    âœ“ contains Utilities category with correct data
    âœ“ contains Warehouse category with correct data (3 ms)
    âœ“ contains Office Supplies category with correct data (1 ms)
    âœ“ contains Insurance category with correct data (2 ms)
  getCategoryById - Retrieval by ID
    âœ“ returns category object for valid ID (2 ms)
    âœ“ returns null for invalid ID (1 ms)
    âœ“ returns null for undefined ID (1 ms)
    âœ“ returns null for null ID (1 ms)
    âœ“ works for all 14 categories (19 ms)
  getAllCategories - Get All Categories
    âœ“ returns object with all categories
    âœ“ returned object matches MERCHANT_CATEGORIES (1 ms)
    âœ“ each value has matching key (1 ms)
  getCategoryList - Get Array of Categories
    âœ“ returns array of all categories (1 ms)
    âœ“ each item is a valid category object (3 ms)
  findCategoryByKeyword - Keyword Matching
    âœ“ finds dining category by "restaurant" keyword
    âœ“ finds dining category by "doordash" keyword (24 ms)
    âœ“ finds groceries category by "whole foods" keyword (1 ms)
    âœ“ finds streaming category by "netflix" keyword
    âœ“ case-insensitive keyword matching (1 ms)
    âœ“ trims whitespace from keyword
    âœ“ returns null for non-existent keyword
    âœ“ returns null for null keyword (1 ms)
    âœ“ returns null for undefined keyword
    âœ“ returns null for empty string
    âœ“ finds category for each test keyword in all categories (3 ms)
  findCategoryByMCCCode - MCC Code Matching
    âœ“ finds dining category by MCC 5812 (1 ms)
    âœ“ finds groceries category by MCC 5411
    âœ“ finds gas category by MCC 5542
    âœ“ finds streaming category by MCC 4899 (25 ms)
    âœ“ works with MCC code as string (3 ms)
    âœ“ returns null for non-existent MCC code
    âœ“ returns null for null MCC code
    âœ“ returns null for undefined MCC code (1 ms)
    âœ“ finds category for each MCC code in system (4 ms)
  findCategoryByRewardAlias - Reward Alias Matching
    âœ“ finds dining category by "dining" alias (1 ms)
    âœ“ finds groceries category by "groceries" alias
    âœ“ finds streaming category by "streaming" alias
    âœ“ case-insensitive alias matching (1 ms)
    âœ“ trims whitespace from alias (1 ms)
    âœ“ returns null for non-existent alias
    âœ“ returns null for null alias
    âœ“ finds category for each reward alias (46 ms)
  findCategory - Universal Search
    âœ“ finds by category ID (1 ms)
    âœ“ finds by keyword (8 ms)
    âœ“ finds by MCC code (1 ms)
    âœ“ finds by reward alias (1 ms)
    âœ“ prefers ID match over keyword match (4 ms)
    âœ“ case-insensitive search (1 ms)
    âœ“ returns null for not found
    âœ“ handles numeric queries as strings then MCC codes (1 ms)
  getCategoryDisplayName - Display Names
    âœ“ returns name with icon for valid category
    âœ“ returns name with icon for all 14 categories (3 ms)
    âœ“ returns "Unknown Category" for invalid ID (1 ms)
    âœ“ returns "Unknown Category" for null ID
  areCategoriesCompatible - Category Compatibility
    âœ“ same category is compatible with itself (1 ms)
    âœ“ streaming is parent of entertainment (child relationship) (1 ms)
    âœ“ returns false for unrelated categories
    âœ“ returns false for invalid categories (1 ms)
  categoryDefinitions - Consistency Tests
    âœ“ no duplicate MCC codes across categories (with allowed overlaps) (24 ms)
    âœ“ no duplicate keywords across categories (keywords should be unique) (1 ms)
    âœ“ no category has empty arrays (4 ms)
    âœ“ all reward aliases are in lowercase (5 ms)

PASS __tests__/unit/query/queryDecomposer.test.js
  QueryDecomposer
    Constructor
      âœ“ creates instance with default context (55 ms)
      âœ“ creates instance with custom context (318 ms)
    Distinct Query Decomposition
      âœ“ decomposes distinct issuers query (182 ms)
      âœ“ decomposes distinct networks query (5 ms)
      âœ“ decomposes distinct query with count (4 ms)
      âœ“ decomposes distinct query with balance filter (25 ms)
      âœ“ decomposes distinct query with breakdown (6 ms)
    Aggregation Query Decomposition
      âœ“ decomposes sum aggregation query (7 ms)
      âœ“ decomposes average aggregation query (3 ms)
      âœ“ decomposes count aggregation query (4 ms)
      âœ“ decomposes grouped aggregation query (68 ms)
      âœ“ decomposes aggregation with sorting (highest) (6 ms)
      âœ“ decomposes aggregation with sorting (lowest) (16 ms)
    Compound Filter Decomposition
      âœ“ decomposes compound filter with AND (13 ms)
      âœ“ decomposes compound filter with OR (25 ms)
      âœ“ decomposes compound filter with network and balance (4 ms)
    Simple Query Decomposition
      âœ“ decomposes simple listing query (2 ms)
      âœ“ decomposes query with balance filter (12 ms)
      âœ“ decomposes query with sorting (5 ms)
    Context Management
      âœ“ updates context after query execution (21 ms)
      âœ“ preserves user profile in context (18 ms)
    Field Mapping
      âœ“ maps natural language fields to database fields (4 ms)
      âœ“ maps "balance" to "current_balance" (2 ms)
    Error Handling
      âœ“ throws error for missing query (81 ms)
      âœ“ throws error for missing entities (2 ms)
    Edge Cases
      âœ“ handles empty entities (1 ms)
      âœ“ handles query with no detectable patterns (58 ms)

PASS __tests__/unit/recommendationStrategies.test.js
  scoreForRewards - Grace Period Rule Enforcement
    âœ“ CRITICAL: Card with $0 balance HAS grace period and CAN be recommended (21 ms)
    âœ“ CRITICAL: Card with $0.01 balance has NO grace period and CANNOT be recommended (1 ms)
    âœ“ CRITICAL: Card with $20,999 balance has NO grace period and CANNOT be recommended (1 ms)
    âœ“ Mixed cards: Only $0 balance cards are recommended (2 ms)
  scoreForRewards - Cashback Calculations
    âœ“ calculates correct cashback for 1.5x rewards on $1000 groceries (1 ms)
    âœ“ calculates correct cashback for 2.0x rewards on $500 dining (1 ms)
    âœ“ uses default multiplier for unknown category (1 ms)
    âœ“ handles $0 amount correctly (1 ms)
  scoreForAPR - Interest Calculations
    âœ“ calculates correct monthly interest for 18.99% APR on $1000 (2 ms)
    âœ“ calculates correct annual interest for 18.99% APR on $1000 (2 ms)
    âœ“ sorts by lowest APR first (1 ms)
    âœ“ handles different balance amounts (2 ms)
  scoreForGracePeriod - Grace Period Rule Enforcement
    âœ“ CRITICAL: Card with $0 balance HAS grace period (20 ms)
    âœ“ CRITICAL: Card with balance has NO grace period (1 ms)
    âœ“ sorts by longest float time first (1 ms)
  getAllStrategies - Integration
    âœ“ returns all three strategies (4 ms)
    âœ“ CRITICAL: Cards with balance are marked correctly across all strategies (3 ms)
    âœ“ handles empty card array (1 ms)
  REGRESSION: Citi Costco with high balance (Fixed 2025-11-06)
    âœ“ Citi Costco with $20,999 balance is NOT recommended for cashflow (1 ms)
    âœ“ Citi Costco with $20,999 balance is NOT recommended for rewards (68 ms)
    âœ“ Citi Costco CAN be shown for APR comparison (even with balance) (1 ms)
  14-Category Support - Reward Multipliers
    Exact Category Matches
      âœ“ dining category returns 4x multiplier (1 ms)
      âœ“ groceries category returns 3x multiplier
      âœ“ gas category returns 4x multiplier (1 ms)
      âœ“ travel category returns 5x multiplier (highest)
      âœ“ entertainment category returns 2x multiplier (2 ms)
      âœ“ streaming category returns 1x multiplier (1 ms)
      âœ“ drugstores category returns 2x multiplier
      âœ“ home_improvement category returns 1x multiplier (1 ms)
      âœ“ department_stores category returns 1x multiplier
      âœ“ transit category returns 2x multiplier (1 ms)
      âœ“ utilities category returns 1x multiplier
      âœ“ warehouse category returns 1.5x multiplier
      âœ“ office_supplies category returns 1x multiplier (1 ms)
      âœ“ insurance category returns 1x multiplier
    Category Aliases - All 14 Categories
      âœ“ restaurants alias maps to dining (4x)
      âœ“ grocery alias maps to groceries (3x) (1 ms)
      âœ“ supermarket alias maps to groceries (3x)
      âœ“ fuel alias maps to gas (4x)
      âœ“ flights alias maps to travel (5x) (1 ms)
      âœ“ hotels alias maps to travel (5x) (2 ms)
      âœ“ airline alias maps to travel (5x) (1 ms)
      âœ“ movies alias maps to entertainment (2x) (1 ms)
      âœ“ theater alias maps to entertainment (2x) (1 ms)
      âœ“ subscriptions alias maps to streaming (1x) (1 ms)
      âœ“ pharmacy alias maps to drugstores (2x) (1 ms)
      âœ“ hardware alias maps to home_improvement (1x) (1 ms)
      âœ“ taxi alias maps to transit (2x)
      âœ“ uber alias maps to transit (2x) (1 ms)
      âœ“ electricity alias maps to utilities (1x) (2 ms)
      âœ“ costco alias maps to warehouse (1.5x)
      âœ“ office_depot alias maps to office_supplies (1x) (1 ms)
      âœ“ auto_insurance alias maps to insurance (1x) (1 ms)
    Case Insensitivity and Whitespace Handling
      âœ“ uppercase category names work correctly (4 ms)
      âœ“ mixed case category names work correctly (14 ms)
      âœ“ whitespace is trimmed from category names
      âœ“ unknown categories return default multiplier
    14 Categories - Scoring Comparison
      âœ“ travel (5x) scores higher than dining (4x) (2 ms)
      âœ“ dining (4x) scores higher than groceries (3x) (1 ms)
      âœ“ all 14 categories have correct multipliers and scores (35 ms)
    Backward Compatibility - Legacy Categories
      âœ“ legacy travel category still works (9 ms)
      âœ“ legacy dining category still works
      âœ“ legacy online category still works (2 ms)
      âœ“ legacy ecommerce alias maps to online (1 ms)
      âœ“ legacy cards return default for new 14-category types
  Travel Rewards Optimization - Category Recognition Fix
    âœ“ CRITICAL: Travel category correctly selects 5x travel card over 2x default card (3 ms)
    âœ“ CRITICAL: Travel category correctly ranks: 5x > 2x travel > 2x default (2 ms)
    âœ“ Travel category with $0 amount still has correct multipliers
    âœ“ Travel aliases (flights, hotels) correctly match travel category (1 ms)
    âœ“ Cards with balance are still excluded even with high travel rewards

  console.warn
    [SyncManager] Cleared 2 items from queue

      350 |     this.retryHandlers.clear();
      351 |     storageManager.clearStore('offlineQueue');
    > 352 |     console.warn(`[SyncManager] Cleared ${clearedCount} items from queue`);
          |             ^
      353 |   }
      354 |
      355 |   /**

      at SyncManager.warn [as clearQueue] (services/sync/syncManager.js:352:13)
      at Object.clearQueue (__tests__/unit/sync/syncManager.test.js:85:19)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/unit/sync/syncManager.test.js:216:22)

  console.error
    [SyncManager] Failed to sync message: API error: 400 - Bad request

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/unit/sync/syncManager.test.js:366:22)

PASS __tests__/unit/sync/syncManager.test.js
  SyncManager
    queue management
      âœ“ should add operation to queue (3 ms)
      âœ“ should add multiple operations to queue (9 ms)
      âœ“ should generate unique operation IDs (3 ms)
      âœ“ should return array of queue items (1 ms)
      âœ“ should clear entire queue (17 ms)
    sync status
      âœ“ should start with idle status (1 ms)
      âœ“ should return queue length (1 ms)
    event handling
      âœ“ should emit operationQueued event (1 ms)
      âœ“ should emit syncStart event (2 ms)
      âœ“ should allow multiple listeners on same event (36 ms)
      âœ“ should unregister event listener (1 ms)
    processQueue
      âœ“ should return immediately if syncing already in progress
      âœ“ should return success if queue is empty (2 ms)
      âœ“ should process queued messages (2 ms)
      âœ“ should handle sync failures with retry (3 ms)
      âœ“ should update queue length after sync
    operation types
      âœ“ should handle message type (9 ms)
      âœ“ should handle card_add type (2 ms)
      âœ“ should handle card_update type (1 ms)
      âœ“ should handle card_delete type (1 ms)
    singleton pattern
      âœ“ should reuse same instance with getSyncManager
      âœ“ should reset to new instance
    partial queue processing
      âœ“ should continue processing if one operation fails (3 ms)

PASS __tests__/integration/enhancedRecommendationEngine.test.js
  EnhancedRecommendationEngine Integration Tests
    Engine Initialization
      âœ“ should initialize with default dependencies (2 ms)
      âœ“ should accept custom options (1 ms)
      âœ“ should initialize with empty metrics (1 ms)
    Input Validation
      âœ“ should throw error if context is missing (139 ms)
      âœ“ should throw error if merchant is missing (1 ms)
      âœ“ should throw error if merchant is not a string (6 ms)
      âœ“ should throw error if cards array is missing (2 ms)
      âœ“ should throw error if cards array is empty (2 ms)
      âœ“ should throw error if card is missing id (32 ms)
      âœ“ should throw error if card is missing name (2 ms)
    E2E Recommendation Flow
      âœ“ should return complete recommendation object (4 ms)
      âœ“ should classify merchant correctly (2 ms)
      âœ“ should return primary recommendation with card details (1 ms)
      âœ“ should return alternative recommendations (3 ms)
    Multi-Card Ranking
      âœ“ should rank cards by reward multiplier (1 ms)
      âœ“ should handle single card correctly (1 ms)
      âœ“ should provide alternatives when available (2 ms)
      âœ“ should exclude specified card from recommendations (1 ms)
      âœ“ should return null primary when all cards excluded (1 ms)
    Performance Testing
      âœ“ should complete recommendation within 500ms target (1 ms)
      âœ“ should handle batch operations efficiently (1 ms)
      âœ“ should meet classification performance target (<10ms)
    Caching Behavior
      âœ“ should cache recommendations (2 ms)
      âœ“ should track cache hits and misses (1 ms)
      âœ“ should not cache when caching disabled
      âœ“ should clear cache on demand (1 ms)
      âœ“ should use LRU eviction when cache full
    Confidence Scoring
      âœ“ should calculate confidence based on classification (31 ms)
      âœ“ should boost confidence with clear multiplier advantage
      âœ“ should lower confidence with similar multipliers (1 ms)
    Strategy-Based Scoring
      âœ“ should score by rewards strategy
      âœ“ should score by APR strategy (1 ms)
      âœ“ should score by grace period strategy (1 ms)
      âœ“ should default to rewards strategy if not specified
    Error Handling and Edge Cases
      âœ“ should handle unknown merchant gracefully (2 ms)
      âœ“ should handle cards with missing category gracefully (1 ms)
      âœ“ should handle very long merchant names (8 ms)
      âœ“ should handle special characters in merchant name (1 ms)
      âœ“ should handle unicode characters in merchant name
    Explanation Generation
      âœ“ should generate explanation for high multiplier (1 ms)
      âœ“ should generate explanation for default multiplier (2 ms)
      âœ“ should generate consistent explanations for alternatives (3 ms)
    Metrics Tracking
      âœ“ should track total requests (5 ms)
      âœ“ should track successful and failed requests (1 ms)
      âœ“ should calculate average latency (1 ms)
      âœ“ should reset metrics on demand (1 ms)
      âœ“ should calculate cache hit rate (2 ms)
    All 14 Categories
      âœ“ should handle Dining category (1 ms)
      âœ“ should handle Groceries category (1 ms)
      âœ“ should handle Gas category (1 ms)
      âœ“ should handle Travel category (1 ms)
      âœ“ should handle Entertainment category
      âœ“ should handle Streaming category (1 ms)
      âœ“ should handle Drugstores category
      âœ“ should handle Home Improvement category (1 ms)
      âœ“ should handle Department Stores category
      âœ“ should handle Transit category (1 ms)
      âœ“ should handle Utilities category
      âœ“ should handle Warehouse category (1 ms)
      âœ“ should handle Office Supplies category
      âœ“ should handle Insurance category
    Timestamp and Metadata
      âœ“ should include valid timestamp in response
      âœ“ should include processing time ms
      âœ“ should flag cached responses

PASS __tests__/unit/merchantClassifier.test.js
  MerchantClassifier
    Constructor & Initialization
      âœ“ creates instance with default options (3 ms)
      âœ“ creates instance with custom options (1 ms)
      âœ“ initializes empty cache
    MVP Critical: Basic Travel Classification
      âœ“ classifies "United Airlines" to travel with high confidence (3 ms)
      âœ“ classifies "flight ticket" to travel (2 ms)
      âœ“ classifies "Delta Air Lines" to travel (1 ms)
      âœ“ classifies "American Airlines" to travel
      âœ“ classifies "airline reservation" to travel
      âœ“ classifies "hotel" to travel (1 ms)
      âœ“ classifies "Marriott Hotels" to travel
      âœ“ classifies travel-related merchant by airline keyword (1 ms)
      âœ“ classifies "transit" to travel or transit category (1 ms)
      âœ“ classifies "taxi" to travel or transit (1 ms)
    MVP: Dining Category
      âœ“ classifies "Chipotle" to dining
      âœ“ classifies "restaurant reservation" to dining (2 ms)
      âœ“ classifies "DoorDash" to dining (1 ms)
      âœ“ classifies "Grubhub" to dining (1 ms)
      âœ“ classifies "Olive Garden" to dining
      âœ“ classifies "Starbucks" to dining (2 ms)
      âœ“ classifies "restaurant" to dining (1 ms)
      âœ“ classifies "coffee" to dining
      âœ“ classifies "cafe" to dining
      âœ“ classifies "meal delivery" to dining (13 ms)
    MVP: Groceries Category
      âœ“ classifies "Whole Foods" to groceries (1 ms)
      âœ“ classifies "Safeway" to groceries
      âœ“ classifies "Kroger" to groceries (1 ms)
      âœ“ classifies "grocery store" to groceries (1 ms)
      âœ“ classifies "supermarket" to groceries
      âœ“ classifies "market" to groceries
      âœ“ classifies "Instacart" to groceries (1 ms)
      âœ“ classifies "amazon fresh" to groceries
      âœ“ classifies "grocery" to groceries
      âœ“ classifies "farmers market" to groceries (1 ms)
    MVP: Gas Category
      âœ“ classifies "Shell" to gas
      âœ“ classifies "Chevron" to gas (28 ms)
      âœ“ classifies "Exxon Mobil" to gas (2 ms)
      âœ“ classifies "BP" to gas (3 ms)
      âœ“ classifies "gas station" to gas (1 ms)
      âœ“ classifies "Speedway" to gas
      âœ“ classifies "fuel" to gas (6 ms)
      âœ“ classifies "petrol" to gas (1 ms)
      âœ“ classifies "ev charging" to gas
      âœ“ classifies "charging station" to gas
    Classification Result Structure
      âœ“ returns object with required fields (2 ms)
      âœ“ confidence is number between 0 and 1 (1 ms)
      âœ“ source is one of valid values
      âœ“ explanation is non-empty string (1 ms)
      âœ“ categoryName matches categoryId (2 ms)
    MCC Code Classification
      âœ“ classifies by MCC code 4511 (airlines)
      âœ“ classifies by MCC code 7011 (lodging) (1 ms)
      âœ“ classifies by MCC code 5812 (dining) (18 ms)
      âœ“ classifies by MCC code 5412 (groceries)
      âœ“ classifies by MCC code 5542 (gas) (1 ms)
      âœ“ MCC code priority: uses valid MCC when keyword could match differently (5 ms)
      âœ“ falls back to keyword when MCC code is invalid (2 ms)
    Keyword Matching
      âœ“ matches exact merchant name (1 ms)
      âœ“ matches case-insensitive (1 ms)
      âœ“ matches with whitespace (1 ms)
      âœ“ matches partial words in merchant name
      âœ“ matches first keyword found
      âœ“ ignores short words in matching (< 3 chars) (1 ms)
    Default Classification (Fallback)
      âœ“ returns default for unknown merchant (1 ms)
      âœ“ returns default for empty string (1 ms)
      âœ“ returns default for only whitespace
      âœ“ includes explanation for default fallback (1 ms)
    Edge Cases & Error Handling
      âœ“ handles null merchant name (1 ms)
      âœ“ handles undefined merchant name (41 ms)
      âœ“ handles numeric merchant name (2 ms)
      âœ“ handles special characters (keywords with letters)
      âœ“ handles merchant name with dining keywords
      âœ“ handles very long merchant name (1 ms)
      âœ“ handles unicode characters (1 ms)
    Caching Functionality
      âœ“ caches classification result (1 ms)
      âœ“ returns cached result on second call
      âœ“ cache option can be set to true explicitly (1 ms)
      âœ“ can clear cache
      âœ“ cache normalizes merchant names (lowercase, trimmed)
      âœ“ get cache statistics (1 ms)
    Batch Operations
      âœ“ classifies multiple merchants (1 ms)
      âœ“ handles mixed valid and invalid merchants
      âœ“ returns empty array for non-array input (1 ms)
      âœ“ returns empty array for null input
    Context Parameter (Future Enhancement)
      âœ“ accepts context parameter without error
      âœ“ context does not affect keyword classification currently
    Supported Categories List
      âœ“ returns list of supported categories (1 ms)
      âœ“ supported categories include MVP 5 (1 ms)
      âœ“ each category has required properties (3 ms)
    Convenience Functions
      âœ“ canClassifyMerchant returns true for known merchant (1 ms)
      âœ“ canClassifyMerchant returns false for unknown merchant (1 ms)
      âœ“ suggestCategories returns suggestions for valid merchant
      âœ“ suggestCategories returns empty array for unknown merchant (1 ms)
      âœ“ suggestCategories requires minimum length
      âœ“ suggestCategories works for partial names
    Default Classifier Singleton
      âœ“ default classifier is available (1 ms)
      âœ“ classifyMerchant uses default classifier
      âœ“ default classifier is reused across calls
      âœ“ default classifier has cache enabled
    Real-World MVP Scenarios
      âœ“ MVP user query: "best card for flight ticket"
      âœ“ MVP user query: "best card for Whole Foods" (1 ms)
      âœ“ MVP user query: "best card for transit"
      âœ“ MVP user query: "which card for Shell" (1 ms)
      âœ“ MVP user query: "best card for Chipotle"
      âœ“ Complex real-world: Multi-word merchant with extra info (1 ms)
      âœ“ Real-world: Merchant with punctuation
      âœ“ Real-world: Airline website purchase
      âœ“ Real-world: Hotel reservation
    Performance Characteristics
      âœ“ classification completes within target time (<10ms)
      âœ“ cached classification is faster than first call (1 ms)
      âœ“ batch classification of 10 merchants completes quickly (1 ms)

PASS __tests__/unit/mccCodeMapper.test.js
  mccCodeMapper - Basic MCC Classification
    âœ“ classifies dining by MCC 5812 (1 ms)
    âœ“ classifies by MCC 5411 (ambiguous - assigned to warehouse) (1 ms)
    âœ“ classifies gas by MCC 5542
    âœ“ classifies travel airlines by MCC 4511 (1 ms)
    âœ“ classifies travel hotels by MCC 7011 (1 ms)
    âœ“ classifies entertainment theaters by MCC 7832 (1 ms)
    âœ“ classifies streaming by MCC 4899
    âœ“ classifies drugstores by MCC 5912
    âœ“ classifies home improvement by MCC 5211 (1 ms)
    âœ“ classifies department stores by MCC 5311
    âœ“ classifies transit by MCC 4111 (1 ms)
    âœ“ classifies utilities by MCC 4814 (1 ms)
    âœ“ classifies office supplies by MCC 5200
    âœ“ classifies insurance by MCC 6211 (1 ms)
  mccCodeMapper - All 14 Categories Have MCC Codes
    âœ“ dining has MCC codes (1 ms)
    âœ“ groceries has MCC codes (2 ms)
    âœ“ gas has MCC codes (1 ms)
    âœ“ travel has MCC codes (1 ms)
    âœ“ entertainment has MCC codes (11 ms)
    âœ“ streaming has MCC codes
    âœ“ drugstores has MCC codes (1 ms)
    âœ“ home_improvement has MCC codes
    âœ“ department_stores has MCC codes (2 ms)
    âœ“ transit has MCC codes
    âœ“ utilities has MCC codes (1 ms)
    âœ“ warehouse has MCC codes
    âœ“ office_supplies has MCC codes
    âœ“ insurance has MCC codes (1 ms)
  mccCodeMapper - Result Object Structure
    âœ“ returns object with required fields (6 ms)
    âœ“ source is always "mcc_code" (1 ms)
    âœ“ confidence is always 0-100 (2 ms)
    âœ“ mccCode is padded to 4 digits (1 ms)
    âœ“ includes explanation text (1 ms)
  mccCodeMapper - Invalid/Edge Cases
    âœ“ handles null MCC code (1 ms)
    âœ“ handles undefined MCC code (1 ms)
    âœ“ handles empty string
    âœ“ handles unknown MCC code (1 ms)
    âœ“ handles string MCC codes
    âœ“ handles numeric string MCC codes (1 ms)
    âœ“ handles MCC codes as numbers
  mccCodeMapper - Confidence Levels
    âœ“ high confidence for unique codes
    âœ“ medium confidence for shared codes (47 ms)
    âœ“ low confidence for ambiguous codes (7 ms)
    âœ“ default confidence for unknown codes (1 ms)
    âœ“ all mapped codes have confidence (17 ms)
  mccCodeMapper - Validation
    âœ“ validates recognized MCC codes (1 ms)
    âœ“ rejects unknown MCC codes
    âœ“ rejects null/undefined
    âœ“ works with string codes (1 ms)
  mccCodeMapper - MCC Description
    âœ“ returns description for known MCC codes (1 ms)
    âœ“ returns "Unknown" for unknown codes
    âœ“ includes category name in description (1 ms)
  mccCodeMapper - Batch Classification
    âœ“ classifies multiple MCC codes (1 ms)
    âœ“ handles mixed valid and invalid codes
    âœ“ returns empty array for non-array input (1 ms)
    âœ“ handles empty array
  mccCodeMapper - Reverse Lookup
    âœ“ finds most confident MCC code for category (1 ms)
    âœ“ finds most confident MCC code for all categories (43 ms)
    âœ“ returns null for invalid category (1 ms)
    âœ“ returns a valid MCC code that maps to the category
  mccCodeMapper - Data Structure Integrity
    âœ“ MCC_TO_CATEGORY_MAP is properly structured (5 ms)
    âœ“ all values in map are valid category IDs (15 ms)
    âœ“ MCC_CONFIDENCE_LEVELS is properly structured (7 ms)
    âœ“ getAllMCCMappings returns copy of map (1 ms)
  mccCodeMapper - Real-World Scenarios
    âœ“ classifies payment processor transaction with MCC code (1 ms)
    âœ“ classifies Netflix subscription with streaming MCC
    âœ“ handles ambiguous grocery/warehouse MCC with note
    âœ“ classifies hotel booking with travel MCC

PASS __tests__/unit/backwardCompatibility.test.js
  Backward Compatibility - Legacy Card Formats
    MVP Card Support - 3 Categories
      âœ“ minimal MVP card works with travel category (106 ms)
      âœ“ minimal MVP card works with dining category
      âœ“ typical MVP card returns correct multipliers (1 ms)
      âœ“ rotating category card works correctly
      âœ“ MVP cards return default for unknown categories (1 ms)
    Phase 2 Cards with 14 Categories
      âœ“ Phase 2 card works with all 14 categories (1 ms)
      âœ“ Phase 2 card works alongside MVP cards (7 ms)
    Mixed Portfolio - MVP + Phase 2 Cards
      âœ“ mixed portfolio scores correctly (1 ms)
      âœ“ APR scoring works across MVP and Phase 2 cards (1 ms)
      âœ“ grace period scoring works across all card types (11 ms)
  Backward Compatibility - getRewardMultiplier Function
    MVP Cards with Old Structure
      âœ“ returns exact match for legacy categories (1 ms)
      âœ“ handles legacy online category
      âœ“ maps ecommerce alias to online
      âœ“ returns default for unknown categories (3 ms)
    Migration Path - Old to New
      âœ“ old card works with legacy categories
      âœ“ old card returns default for new categories (1 ms)
      âœ“ migration is non-breaking - old code path continues
  Backward Compatibility - API Signatures
    scoreForRewards API
      âœ“ function signature unchanged
      âœ“ returns same response structure (28 ms)
    scoreForAPR API
      âœ“ function signature unchanged (1 ms)
      âœ“ returns same response structure (1 ms)
    scoreForGracePeriod API
      âœ“ function signature unchanged (1 ms)
      âœ“ returns same response structure (1 ms)
    getAllStrategies API
      âœ“ function signature unchanged (4 ms)
      âœ“ returns same structure for all strategies (1 ms)
  Backward Compatibility - Critical Features
    Grace Period Rule - Critical Feature
      âœ“ card with balance has NO grace period (1 ms)
      âœ“ card with $0 balance HAS grace period (9 ms)
      âœ“ grace period rule is enforced consistently
    Interest Calculation - Critical Feature
      âœ“ monthly interest calculated correctly for card with balance (1 ms)
      âœ“ zero balance card has zero interest due (1 ms)
    Cashback Calculation - Critical Feature
      âœ“ cashback calculated with correct multiplier (1 ms)
      âœ“ unknown category returns default cashback
  Backward Compatibility - Real-World Scenarios
    âœ“ real portfolio: best card for dining (2 ms)
    âœ“ real portfolio: best card for groceries
    âœ“ real portfolio: best card by APR
    âœ“ real portfolio: best card for travel (new category)
  Backward Compatibility - Edge Cases
    âœ“ card with null reward_structure returns default
    âœ“ card with missing reward_structure returns default (1 ms)
    âœ“ empty cards array returns empty results (1 ms)
    âœ“ null cards array returns empty results (1 ms)
    âœ“ zero amount purchase returns zero cashback (1 ms)
    âœ“ very high APR card still returns valid score
    âœ“ very low APR card returns valid score (1 ms)
    âœ“ card with high balance but low APR

PASS __tests__/unit/query/queryBuilder.test.js
  QueryBuilder
    Constructor
      âœ“ creates instance with cards array (2 ms)
      âœ“ clones cards array to avoid mutation
      âœ“ throws error for non-array input (91 ms)
      âœ“ handles empty array (1 ms)
    Filtering
      âœ“ filters by exact string match (case-insensitive) (4 ms)
      âœ“ filters by numeric comparison (1 ms)
      âœ“ filters with multiple AND conditions (77 ms)
      âœ“ filters with OR condition
      âœ“ filters with "in" operator (5 ms)
      âœ“ filters with "between" operator (2 ms)
      âœ“ filters with "contains" operator (5 ms)
      âœ“ filters with custom function (1 ms)
      âœ“ handles null/undefined field values (1 ms)
      âœ“ returns empty array when no filters match
    Distinct Operations
      âœ“ gets distinct issuers (6 ms)
      âœ“ gets distinct issuers with count (39 ms)
      âœ“ gets distinct card networks (7 ms)
      âœ“ distinct with limit (1 ms)
      âœ“ distinct ignores null/undefined values (3 ms)
      âœ“ distinct with filters (1 ms)
    Aggregations
      âœ“ sums current balance (1 ms)
      âœ“ calculates average APR
      âœ“ counts cards
      âœ“ finds minimum balance (1 ms)
      âœ“ finds maximum balance (2 ms)
      âœ“ counts distinct issuers
      âœ“ grouped aggregation by issuer (2 ms)
      âœ“ multiple aggregations (17 ms)
      âœ“ aggregation with filters (2 ms)
    Sorting
      âœ“ sorts ascending by balance (2 ms)
      âœ“ sorts descending by balance (1 ms)
      âœ“ sorts by string field
      âœ“ sort with limit (1 ms)
      âœ“ sort with filters (2 ms)
    Limit
      âœ“ limits results
      âœ“ limit with sorting (1 ms)
    Field Selection
      âœ“ selects specific fields (1 ms)
      âœ“ select with filters (9 ms)
    Complex Queries
      âœ“ filter + sort + limit
      âœ“ filter + distinct + count (1 ms)
      âœ“ grouped aggregation with sorting
    Metadata
      âœ“ includes execution metadata (1 ms)
    Clone and Reset
      âœ“ clone creates independent instance
      âœ“ reset clears all state (1 ms)
    Error Handling
      âœ“ throws error for invalid field in filter (2 ms)
      âœ“ throws error for invalid operator (1 ms)
      âœ“ throws error for invalid logical operator (1 ms)
      âœ“ throws error for invalid aggregation (3 ms)
      âœ“ throws error for invalid sort direction (1 ms)
      âœ“ throws error for negative limit (58 ms)
    Edge Cases
      âœ“ handles empty cards array (1 ms)
      âœ“ handles cards with missing fields
      âœ“ handles very large result sets (2 ms)

  console.error
    [CategoryMatcher] Error finding multiplier: Error: Card is required for CategoryMatcher
        at new CategoryMatcher (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/recommendations/categoryMatcher.js:24:13)
        at findRewardMultiplier (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/recommendations/categoryMatcher.js:264:21)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/categoryMatcher.test.js:662:34)
        at Promise.then.completed (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/testWorker.js:106:12)

      265 |     return matcher.findRewardMultiplier(category);
      266 |   } catch (error) {
    > 267 |     console.error('[CategoryMatcher] Error finding multiplier:', error);
          |             ^
      268 |     return 1; // Safe fallback
      269 |   }
      270 | }

      at error (services/recommendations/categoryMatcher.js:267:13)
      at Object.<anonymous> (__tests__/unit/categoryMatcher.test.js:662:34)

  console.error
    [CategoryMatcher] Error finding multiplier: Error: Card is required for CategoryMatcher
        at new CategoryMatcher (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/recommendations/categoryMatcher.js:24:13)
        at findRewardMultiplier (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/recommendations/categoryMatcher.js:264:21)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/categoryMatcher.test.js:663:34)
        at Promise.then.completed (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/testWorker.js:106:12)

      265 |     return matcher.findRewardMultiplier(category);
      266 |   } catch (error) {
    > 267 |     console.error('[CategoryMatcher] Error finding multiplier:', error);
          |             ^
      268 |     return 1; // Safe fallback
      269 |   }
      270 | }

      at error (services/recommendations/categoryMatcher.js:267:13)
      at Object.<anonymous> (__tests__/unit/categoryMatcher.test.js:663:34)

  console.error
    [CategoryMatcher] Error getting explanation: Error: Card is required for CategoryMatcher
        at new CategoryMatcher (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/recommendations/categoryMatcher.js:24:13)
        at getRewardExplanation (/Users/marxkatragadda/Documents/VittaChat/Vitta/services/recommendations/categoryMatcher.js:281:21)
        at Object.<anonymous> (/Users/marxkatragadda/Documents/VittaChat/Vitta/__tests__/unit/categoryMatcher.test.js:679:47)
        at Promise.then.completed (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/marxkatragadda/Documents/VittaChat/Vitta/node_modules/jest-runner/build/testWorker.js:106:12)

      282 |     return matcher.getExplanation(category);
      283 |   } catch (error) {
    > 284 |     console.error('[CategoryMatcher] Error getting explanation:', error);
          |             ^
      285 |     return 'Standard rewards apply';
      286 |   }
      287 | }

      at error (services/recommendations/categoryMatcher.js:284:13)
      at Object.<anonymous> (__tests__/unit/categoryMatcher.test.js:679:47)

PASS __tests__/integration/phase2EndToEnd.test.js
  Phase 2 End-to-End Integration Tests
    Real-World User Scenarios
      âœ“ User asks for best card for Costco (grocery warehouse) (230 ms)
      âœ“ User wants to maximize rewards for restaurant dinner (4 ms)
      âœ“ User needs to know lowest APR for balance transfer (2 ms)
      âœ“ User wants grace period information for cash flow optimization (69 ms)
      âœ“ Complete purchase decision workflow (1 ms)
      âœ“ Multi-strategy comparison for same purchase (2 ms)
    Card Migration Integration
      âœ“ User adds old MVP card - system automatically supports it (30 ms)
      âœ“ Portfolio with MVP cards can be analyzed for migration (35 ms)
    Category Coverage Across All 14 Categories
      âœ“ Portfolio covers all 14 categories with reasonable recommendations (35 ms)
      âœ“ Each category finds at least one card with grace period (17 ms)
    Complex Purchase Scenarios
      âœ“ Business travel expenses - maximize rewards across categories (55 ms)
    Edge Cases and Error Handling
      âœ“ Handles MVP cards with limited categories gracefully (1 ms)
      âœ“ All 14 categories are accessible even with MVP cards (2 ms)
    Performance and Optimization
      âœ“ Recommendation scoring is performant for large portfolios (4 ms)

PASS __tests__/unit/categoryMatcher.test.js
  CategoryMatcher
    Constructor & Initialization
      âœ“ creates instance with card object (1 ms)
      âœ“ throws error if card is not provided (102 ms)
      âœ“ handles card with no reward_structure (1 ms)
      âœ“ handles card with null reward_structure
      âœ“ stores card and rewards references (1 ms)
    Simple Reward Format (Number)
      âœ“ finds multiplier for simple format { travel: 3 } (1 ms)
      âœ“ handles case-insensitive category lookup (1 ms)
      âœ“ handles whitespace in category name
      âœ“ returns null multiplier for missing category (1 ms)
    Complex Reward Format (Object)
      âœ“ extracts multiplier from object format { value, note }
      âœ“ extracts multiplier from object with multiple properties (1 ms)
      âœ“ handles mixed simple and complex formats
      âœ“ returns default if object has no value property
      âœ“ returns default if value is not a number (1 ms)
    MVP: Basic Card Scenarios
      âœ“ Chase Sapphire Preferred: 3x travel, 2x dining
      âœ“ American Express Gold: 4x dining, 4x groceries (34 ms)
      âœ“ Citi Custom Cash: 5x gas and groceries
      âœ“ Generic cashback card: 1.5% on everything (1 ms)
      âœ“ No rewards card: 0% on all categories (1 ms)
    Subcategory Matching
      âœ“ prefers exact category match over subcategory (exact takes priority) (1 ms)
      âœ“ uses subcategory key formatting when no exact category match (2 ms)
      âœ“ ignores null subcategory
    Rotating Categories
      âœ“ finds rotating category match (1 ms)
      âœ“ returns default for non-rotating categories
      âœ“ handles rotating with no active categories (1 ms)
      âœ“ static category takes priority over rotating categories
    Default Multiplier
      âœ“ returns hardcoded 1 if no default specified (5 ms)
      âœ“ returns default multiplier if specified (1 ms)
      âœ“ handles default as object format
      âœ“ returns 1 if default has no value
    Reward Categories List
      âœ“ returns all categories with rewards > 1 (1 ms)
      âœ“ returns multiplier for each category (1 ms)
      âœ“ excludes default and rotating from list (1 ms)
      âœ“ returns empty array if no rewards (1 ms)
    Best Category
      âœ“ returns category with highest multiplier (1 ms)
      âœ“ returns first highest if tie (1 ms)
      âœ“ returns null if no rewards
    Has Reward Check
      âœ“ returns true if multiplier >= minMultiplier (1 ms)
      âœ“ returns false if multiplier < minMultiplier
      âœ“ accepts custom minMultiplier (1 ms)
    Explanation Generation
      âœ“ generates explanation for category with rewards (1 ms)
      âœ“ generates explanation for no rewards
    Convenience Functions
      âœ“ findRewardMultiplier finds multiplier for card and category (1 ms)
      âœ“ findRewardMultiplier returns 1 on error (148 ms)
      âœ“ getRewardExplanation generates explanations (2 ms)
      âœ“ getRewardExplanation handles errors (4 ms)
    Score Cards By Category
      âœ“ scores and ranks cards by category (1 ms)
      âœ“ includes explanation in score (1 ms)
      âœ“ returns empty array for invalid input
      âœ“ handles empty card list (1 ms)
    MVP Real-World Scenarios
      âœ“ MVP: User asks for best card for travel (10 ms)
      âœ“ MVP: User asks for best card for dining
      âœ“ MVP: User asks for best card for groceries (2 ms)
    Edge Cases
      âœ“ handles zero multiplier
      âœ“ handles negative multiplier (should still work) (1 ms)
      âœ“ handles very high multiplier
      âœ“ handles decimal multiplier (1 ms)
      âœ“ handles category with empty string
      âœ“ handles null category input
    Performance Characteristics
      âœ“ lookup completes within target time (<5ms)
      âœ“ scoring multiple cards is fast (1 ms)

PASS __tests__/unit/query/operators.test.js
  Operators
    evaluate
      Equality operators
        âœ“ == operator with matching strings (case-insensitive) (1 ms)
        âœ“ == operator with non-matching strings (7 ms)
        âœ“ == operator with numbers (1 ms)
        âœ“ != operator
        âœ“ == operator with null/undefined
      Comparison operators
        âœ“ > operator
        âœ“ >= operator (1 ms)
        âœ“ < operator
        âœ“ <= operator (1 ms)
        âœ“ Comparison operators with non-numeric values return false
      String operators
        âœ“ contains operator (case-insensitive) (1 ms)
        âœ“ starts_with operator (2 ms)
        âœ“ ends_with operator (101 ms)
      Array operators
        âœ“ in operator (2 ms)
        âœ“ in operator with case-insensitive string matching (2 ms)
        âœ“ in operator with non-array returns false (1 ms)
        âœ“ between operator (1 ms)
        âœ“ between operator with invalid array returns false (1 ms)
        âœ“ between operator with non-numeric values returns false
      Error handling
        âœ“ throws error for invalid operator (15 ms)
    VALID_OPERATORS
      âœ“ contains all operator types (1 ms)

  console.warn
    [StatementCycle] Invalid date values: { statementCloseDate: 'invalid', paymentDueDate: 'invalid' }

      35 |   // Validate dates
      36 |   if (isNaN(closeDate.getTime()) || isNaN(dueDate.getTime())) {
    > 37 |     console.warn('[StatementCycle] Invalid date values:', { statementCloseDate, paymentDueDate });
         |             ^
      38 |     return 25;
      39 |   }
      40 |

      at warn (utils/statementCycleUtils.js:37:13)
      at Object.<anonymous> (__tests__/unit/statementCycleUtils.test.js:172:32)

PASS __tests__/unit/statementCycleUtils.test.js
  getPaymentDueDate - Month Boundary Handling
    âœ“ CRITICAL: handles month boundary correctly (25th â†’ 10th) (2 ms)
    âœ“ CRITICAL: handles same month correctly (5th â†’ 20th) (1 ms)
    âœ“ handles end of year crossing (Dec 25 â†’ Jan 10) (1 ms)
    âœ“ handles 31st day of month correctly (1 ms)
    âœ“ handles February dates correctly (non-leap year) (1 ms)
    âœ“ handles leap year February correctly (80 ms)
    âœ“ handles null/undefined inputs gracefully (3 ms)
  getStatementCloseDate - Recent Statement Calculation
    âœ“ returns current month if statement day is in the past (1 ms)
    âœ“ returns previous month if statement day is in the future
    âœ“ handles today being statement close day (2 ms)
    âœ“ handles end of month correctly (2 ms)
    âœ“ returns null for invalid input
  getDaysUntilPaymentDue - Days Calculation
    âœ“ calculates positive days for future payment (2 ms)
    âœ“ rolls overdue payment into the next cycle (non-negative days) (11 ms)
    âœ“ returns 0 days when payment is due today
  calculateGracePeriod - Grace Period Calculation
    âœ“ calculates grace period correctly for same month (110 ms)
    âœ“ calculates grace period correctly across months
    âœ“ returns default (25 days) for null inputs
    âœ“ returns default for invalid dates (11 ms)
    âœ“ warns for unusual grace periods (1 ms)
  REGRESSION: Payment Due Date Recalculation Bug (Fixed 2025-11-06)
    âœ“ does not recalculate statement close date when provided
    âœ“ correct dates for all real user cards (Nov 7, 2025) (2 ms)
    âœ“ handles month boundary edge cases correctly (2 ms)
  Edge Cases
    âœ“ handles statement close and payment due on same day by rolling to next month
    âœ“ handles maximum month boundary (Dec 31 â†’ Jan 1) (1 ms)
    âœ“ handles February 30th gracefully (invalid date)

PASS __tests__/unit/splitPaymentVariedData.test.js
  Split Payment with TEST_DATA_VARIED.sql Data
    âœ“ should show ALL cards in the split table (27 cards from test data) (196 ms)
    âœ“ should calculate total minimum payments correctly ($3,450) (110 ms)
    âœ“ should distribute $6,000 budget correctly (minimums + APR-weighted extra) (11 ms)
    âœ“ should include zero balance cards in the table (26 ms)
    âœ“ should prioritize highest APR cards for extra payments (26 ms)
    âœ“ should handle insufficient budget correctly (budget < total minimum) (36 ms)
    âœ“ should show all cards when budget equals minimum payments (74 ms)

PASS __tests__/unit/textExtraction.test.js
  extractAmount
    Dollar sign formats
      âœ“ extracts simple dollar amount (1 ms)
      âœ“ extracts dollar amount with commas (2 ms)
      âœ“ extracts dollar amount with decimals (1 ms)
      âœ“ handles space after dollar sign
    Word formats
      âœ“ extracts amount with "dollars" (1 ms)
      âœ“ extracts amount with "USD"
      âœ“ extracts amount with "bucks" (1 ms)
    K notation
      âœ“ extracts amount with k (1 ms)
      âœ“ respects allowK option (7 ms)
    Plain numbers
      âœ“ extracts plain numbers (1 ms)
      âœ“ respects minDigits option (1 ms)
    Complex sentences
      âœ“ extracts from natural language (1 ms)
      âœ“ handles the reported bug case (1 ms)
    Edge cases
      âœ“ returns null for no amount (1 ms)
      âœ“ returns null for invalid input
      âœ“ ignores very small numbers with minDigits
      âœ“ handles zero (returns null)
      âœ“ extracts absolute value from negative notation
  extractAllAmounts
    âœ“ extracts multiple amounts from text (1 ms)
    âœ“ extracts mixed format amounts (1 ms)
    âœ“ returns empty array for no amounts (1 ms)
    âœ“ removes duplicates
  extractPercentage
    âœ“ extracts percentage with % sign (1 ms)
    âœ“ extracts percentage with "percent" word (71 ms)
    âœ“ extracts decimal format (6 ms)
    âœ“ returns null for invalid percentages (2 ms)
  formatAmount
    âœ“ formats amount with dollar sign and commas (164 ms)
    âœ“ respects decimals option (2 ms)
    âœ“ respects includeSymbol option (1 ms)
    âœ“ handles edge cases (1 ms)
    âœ“ formats large amounts (26 ms)
  Real-world integration scenarios
    âœ“ handles user query variations for $5000 (4 ms)
    âœ“ handles budget context extraction (1 ms)
    âœ“ handles payment split scenarios

  console.error
    [SyncManager] Failed to sync message: API error: 503 - Service unavailable

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:135:20)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:168:24)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:168:24)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:168:24)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:168:24)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:168:24)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - Server error

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:173:27)

  console.warn
    [RetryHandler] Max retries (5) exceeded

      52 |
      53 |     if (!canRetry) {
    > 54 |       console.warn(`[RetryHandler] Max retries (${this.maxRetries}) exceeded`);
         |               ^
      55 |     }
      56 |
      57 |     return canRetry;

      at RetryHandler.warn [as shouldRetry] (services/sync/retryHandler.js:54:15)
      at SyncManager.shouldRetry (services/sync/syncManager.js:286:40)
      at SyncManager.handleRetry (services/sync/syncManager.js:176:19)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:173:27)

  console.error
    [SyncManager] Operation 1764557799055_x8j9kvujc exceeded max retries

      285 |
      286 |     if (!retryHandler || !retryHandler.shouldRetry()) {
    > 287 |       console.error(`[SyncManager] Operation ${operation.id} exceeded max retries`);
          |               ^
      288 |       this.emit('operationFailed', operation);
      289 |       return false;
      290 |     }

      at SyncManager.error [as handleRetry] (services/sync/syncManager.js:287:15)
      at SyncManager.handleRetry (services/sync/syncManager.js:176:19)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:173:27)

  console.error
    [SyncManager] Failed to sync message: API error: 400 - undefined

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:247:22)

  console.error
    [SyncManager] Failed to sync message: API error: 500 - undefined

      173 |       }
      174 |     } catch (error) {
    > 175 |       console.error(`[SyncManager] Failed to sync message: ${error.message}`);
          |               ^
      176 |       return this.handleRetry(operation);
      177 |     }
      178 |   }

      at SyncManager.error [as syncMessage] (services/sync/syncManager.js:175:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:130:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/offlineOnlineSync.e2e.test.js:247:22)

  console.warn
    [RetryHandler] Max retries (5) exceeded

      52 |
      53 |     if (!canRetry) {
    > 54 |       console.warn(`[RetryHandler] Max retries (${this.maxRetries}) exceeded`);
         |               ^
      55 |     }
      56 |
      57 |     return canRetry;

      at RetryHandler.warn [as shouldRetry] (services/sync/retryHandler.js:54:15)
      at Object.shouldRetry (__tests__/unit/sync/retryHandler.test.js:138:27)

  console.warn
    [RetryHandler] Max retries (2) exceeded

      52 |
      53 |     if (!canRetry) {
    > 54 |       console.warn(`[RetryHandler] Max retries (${this.maxRetries}) exceeded`);
         |               ^
      55 |     }
      56 |
      57 |     return canRetry;

      at RetryHandler.warn [as shouldRetry] (services/sync/retryHandler.js:54:15)
      at Object.shouldRetry (__tests__/unit/sync/retryHandler.test.js:147:22)

PASS __tests__/e2e/offlineOnlineSync.e2e.test.js
  E2E: Complete Offline/Online Sync Flow
    Full User Journey: Offline â†’ Queue â†’ Online â†’ Sync
      âœ“ should complete full offline workflow from start to finish (35 ms)
    Retry on Temporary Failure
      âœ“ should retry failed operations with exponential backoff (8 ms)
      âœ“ should max out retries after 5 attempts (58 ms)
    Mixed Operation Types Flow
      âœ“ should handle mixed messages and card operations in correct order (3 ms)
    Partial Sync Scenarios
      âœ“ should continue syncing even if some operations fail (5 ms)
    Network Recovery Scenarios
      âœ“ should handle network coming back after being offline for extended period (3 ms)
    Concurrent Operations
      âœ“ should not process queue if already syncing (104 ms)
    Data Consistency
      âœ“ should maintain FIFO order throughout sync process (2 ms)
    Event Notifications Throughout Flow
      âœ“ should emit correct sequence of events (1 ms)

  console.warn
    [QueryValidator] Unknown field "unknown_field" used in query. Known fields: id, user_id, catalog_id, card_name, nickname...

      87 |     // Warn about unknown fields but allow them for extensibility
      88 |     if (!KNOWN_CARD_FIELDS.includes(field)) {
    > 89 |       console.warn(
         |               ^
      90 |         `[QueryValidator] Unknown field "${field}" used in query. ` +
      91 |         `Known fields: ${KNOWN_CARD_FIELDS.slice(0, 5).join(', ')}...`
      92 |       );

      at Object.warn [as validateField] (utils/query/validators.js:89:15)
      at validateField (__tests__/unit/query/validators.test.js:59:23)
      at Object.<anonymous> (node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (node_modules/expect/build/index.js:320:21)
      at Object.toThrow (__tests__/unit/query/validators.test.js:60:10)

  console.warn
    [RetryHandler] Max retries (5) exceeded

      52 |
      53 |     if (!canRetry) {
    > 54 |       console.warn(`[RetryHandler] Max retries (${this.maxRetries}) exceeded`);
         |               ^
      55 |     }
      56 |
      57 |     return canRetry;

      at RetryHandler.warn [as shouldRetry] (services/sync/retryHandler.js:54:15)
      at Object.shouldRetry (__tests__/unit/sync/retryHandler.test.js:173:27)

  console.warn
    [RetryHandler] Max retries (0) exceeded

      52 |
      53 |     if (!canRetry) {
    > 54 |       console.warn(`[RetryHandler] Max retries (${this.maxRetries}) exceeded`);
         |               ^
      55 |     }
      56 |
      57 |     return canRetry;

      at RetryHandler.warn [as shouldRetry] (services/sync/retryHandler.js:54:15)
      at Object.shouldRetry (__tests__/unit/sync/retryHandler.test.js:214:22)

PASS __tests__/unit/query/responseGenerator.test.js
  ResponseGenerator
    Constructor
      âœ“ creates instance with default options (1 ms)
      âœ“ creates instance with custom options (1 ms)
    Distinct Query Responses
      âœ“ formats distinct issuers response (16 ms)
      âœ“ formats distinct networks response (1 ms)
      âœ“ handles empty distinct results (10 ms)
    Aggregation Query Responses
      âœ“ formats sum aggregation response (16 ms)
      âœ“ formats average aggregation response (1 ms)
      âœ“ formats count aggregation response (1 ms)
    Grouped Aggregation Responses
      âœ“ formats grouped aggregation response (4 ms)
    Table Responses
      âœ“ formats table response for listing query (3 ms)
      âœ“ formats table response with filters (23 ms)
      âœ“ truncates large tables (13 ms)
      âœ“ handles empty table results (1 ms)
    Field Formatting
      âœ“ formats currency fields correctly
      âœ“ formats percentage fields correctly (1 ms)
      âœ“ formats utilization with emoji (1 ms)
      âœ“ uses nickname over card_name (1 ms)
    Insights Generation
      âœ“ generates insights for high total balance (1 ms)
      âœ“ generates insights for high average APR
    Error Handling
      âœ“ throws error for missing queryResults (29 ms)
      âœ“ throws error for missing structuredQuery (2 ms)
    Summary Generation
      âœ“ includes summary for listing queries (1 ms)

PASS __tests__/unit/sync/retryHandler.test.js
  RetryHandler
    initialization
      âœ“ should initialize with default values (5 ms)
      âœ“ should initialize with custom max retries (54 ms)
    exponential backoff
      âœ“ should return initial delay on first retry (2 ms)
      âœ“ should double delay on second retry (13 ms)
      âœ“ should continue exponential backoff (2 ms)
      âœ“ should cap maximum delay at 32 seconds (1 ms)
      âœ“ should add jitter to prevent thundering herd (2 ms)
    retry tracking
      âœ“ should increment retry count on each call (2 ms)
      âœ“ should track last retry time (1 ms)
      âœ“ should have null last retry time initially (3 ms)
    shouldRetry
      âœ“ should allow retries within limit (30 ms)
      âœ“ should deny retries after max exceeded (10 ms)
      âœ“ should respect custom max retries (8 ms)
    reset
      âœ“ should reset retry count to zero (3 ms)
      âœ“ should reset last retry time (1 ms)
      âœ“ should allow retries again after reset (49 ms)
    getStatus
      âœ“ should return correct status string (2 ms)
    multiple instances
      âœ“ should have independent state for each instance (3 ms)
    edge cases
      âœ“ should handle zero max retries (6 ms)
      âœ“ should handle very small initial delay (2 ms)
      âœ“ should handle multiple resets (66 ms)

PASS __tests__/unit/query/validators.test.js
  Query Validators
    validateField
      âœ“ validates known fields without error (1 ms)
      âœ“ throws error for empty string (15 ms)
      âœ“ throws error for null (1 ms)
      âœ“ throws error for undefined (5 ms)
      âœ“ throws error for non-string (1 ms)
      âœ“ warns for unknown fields but allows them (1 ms)
      âœ“ strict mode only allows known fields (53 ms)
    validateOperator
      âœ“ validates valid operators
      âœ“ validates "in" operator with array (1 ms)
      âœ“ throws error for "in" operator with non-array
      âœ“ throws error for "in" operator with empty array (2 ms)
      âœ“ validates "between" operator with 2-element array (1 ms)
      âœ“ throws error for "between" operator with wrong array length (6 ms)
      âœ“ throws error for "between" operator with min > max (2 ms)
      âœ“ throws error for null operator (2 ms)
    validateLogicalOperator
      âœ“ validates AND operator (1 ms)
      âœ“ validates OR operator
      âœ“ throws error for invalid logical operator (1 ms)
      âœ“ throws error for null (1 ms)
    validateAggregation
      âœ“ validates valid aggregation operations (1 ms)
      âœ“ throws error for invalid operation (38 ms)
      âœ“ throws error when operation requires field but field is null (1 ms)
      âœ“ allows count without field (3 ms)
    validateSortDirection
      âœ“ validates asc direction (1 ms)
      âœ“ validates desc direction
      âœ“ throws error for invalid direction (18 ms)
      âœ“ throws error for null (1 ms)
    validateLimit
      âœ“ validates positive integer limit (1 ms)
      âœ“ throws error for negative number (2 ms)
      âœ“ throws error for non-integer (2 ms)
      âœ“ throws error for non-number (5 ms)
    validateCards
      âœ“ validates array of cards (2 ms)
      âœ“ throws error for non-array (8 ms)
    Constants
      âœ“ KNOWN_CARD_FIELDS contains expected fields (1 ms)
      âœ“ LOGICAL_OPERATORS contains AND and OR

PASS __tests__/unit/diningRecommendation.test.js
  Dining Recommendations - Best Card Selection
    âœ“ CRITICAL: Both Citi Custom Cash and Discover It should have 5x for dining (3 ms)
    âœ“ CRITICAL: 5x dining cards should rank higher than 4x dining cards (2 ms)
    âœ“ Discover It "restaurants" should correctly map to "dining" category
    âœ“ Citi Custom Cash direct "dining" should work correctly (1 ms)
    âœ“ When both have 5x, tiebreakers should work (lower APR, better credit, etc.) (72 ms)

PASS __tests__/unit/service-worker/sw.test.js
  Service Worker
    Cache Names
      âœ“ should have correct cache version prefix (2 ms)
      âœ“ should have separate cache stores (1 ms)
    Static Assets Detection
      âœ“ should identify JavaScript files
      âœ“ should identify CSS files
      âœ“ should identify font files (78 ms)
    Image Detection
      âœ“ should identify image formats (16 ms)
    HTML Detection
      âœ“ should identify HTML pages (1 ms)
    Cache Expiration
      âœ“ should have expiration times configured (1 ms)
      âœ“ network timeout should be set (1 ms)
      âœ“ image size limit should be configured (1 ms)
    Static Assets List
      âœ“ should have precache list (2 ms)
    Request Methods
      âœ“ should only cache GET requests (6 ms)
    URL Protocol Detection
      âœ“ should handle HTTP requests (27 ms)
      âœ“ should handle HTTPS requests (1 ms)
      âœ“ should skip Chrome extension requests (1 ms)
    Caching Strategies
      âœ“ cache-first strategy should check cache first
      âœ“ network-first strategy should try network first (11 ms)
      âœ“ network-only strategy should always use network (1 ms)
    Route Pattern Matching
      âœ“ should route API calls to network-first (1 ms)
      âœ“ should route static assets to cache-first (1 ms)
      âœ“ should route images to cache-first (1 ms)
      âœ“ should route HTML pages to network-first (15 ms)
      âœ“ should route OpenAI API to network-only (1 ms)
    Error Handling
      âœ“ should provide offline fallback for HTML
      âœ“ should provide JSON error for API (1 ms)
      âœ“ should handle missing resources gracefully (1 ms)
    Cache Versioning
      âœ“ old caches should be deleted on activation (3 ms)
    Background Sync
      âœ“ should handle sync events (5 ms)
    Message Handling
      âœ“ should handle SKIP_WAITING message (146 ms)
      âœ“ should handle CLEAR_CACHE message (1 ms)
      âœ“ should handle GET_CACHE_SIZE message (2 ms)
    Image Size Limiting
      âœ“ images smaller than limit should be cached (1 ms)
      âœ“ images larger than limit should not be cached (1 ms)

PASS __tests__/unit/sync/cardOperationSync.test.js
  CardOperationSync Module
    âœ“ should export all required functions (197 ms)
    âœ“ should have navigator.onLine property in global scope (2 ms)
    âœ“ should support online state detection (1 ms)
  Card Operation Sync Integration
    âœ“ card operation sync service integrates with sync manager (271 ms)
  Card Operation Types
    âœ“ should support card_add operation type
    âœ“ should support card_update operation type
    âœ“ should support card_delete operation type (1 ms)
  Offline Detection
    âœ“ should detect offline state (1 ms)
    âœ“ should detect online state
    âœ“ should toggle between online and offline states (1 ms)

PASS __tests__/integration/service-worker/caching.test.js
  Service Worker Caching Integration
    Cache-First Strategy
      âœ“ should return cached response when available (3 ms)
      âœ“ should fetch and cache when not cached (1 ms)
      âœ“ should work for static assets (1 ms)
      âœ“ should work for images (1 ms)
    Network-First Strategy
      âœ“ should fetch from network when available (3 ms)
      âœ“ should fallback to cache on network failure (1 ms)
      âœ“ should return offline fallback if cache missing (1 ms)
      âœ“ should work for HTML pages (1 ms)
      âœ“ should work for API endpoints (2 ms)
      âœ“ should have network timeout (1 ms)
    Network-Only Strategy
      âœ“ should always fetch from network (109 ms)
      âœ“ should return error if network fails (4 ms)
      âœ“ should work for OpenAI API (1 ms)
      âœ“ should never cache responses (1 ms)
    Offline Fallback
      âœ“ should return HTML page for HTML requests
      âœ“ should return JSON error for API requests (1 ms)
      âœ“ should provide offline page URL (1 ms)
      âœ“ should include error message in JSON response
    Cache Cleanup
      âœ“ should delete old cache versions (1 ms)
      âœ“ should keep current version caches
      âœ“ should handle multiple old versions (1 ms)
    Image Caching
      âœ“ should cache images under size limit (1 ms)
      âœ“ should not cache images over size limit (2 ms)
      âœ“ should return placeholder for missing images (1 ms)
      âœ“ should cache common image formats (1 ms)
    Request Routing
      âœ“ should route requests to correct strategy (1 ms)
    Cache Update
      âœ“ should update cache on successful response (1 ms)
      âœ“ should not update cache on error response
    Offline Scenarios
      âœ“ should handle user going offline during fetch (1 ms)
      âœ“ should handle completely offline user
      âœ“ should handle coming back online (1 ms)
    Cache Performance
      âœ“ static cache should be fastest
      âœ“ network-first should be slower when online
      âœ“ network-only should be slowest (1 ms)

PASS __tests__/unit/homeImprovementRecommendation.test.js
  Home Improvement Recommendations
    âœ“ CRITICAL: "home_improvement" category correctly finds 5x multiplier (2 ms)
    âœ“ CRITICAL: All 5x home improvement cards rank higher than 2x default (2 ms)
    âœ“ "hardware" alias correctly maps to home_improvement category (1 ms)
    âœ“ Cards with 0 balance can be recommended for home_improvement
    âœ“ CRITICAL: "home improvement" (with space) correctly maps to "home_improvement" multiplier (1 ms)

  console.error
    [SyncManager] Failed to sync card add: API error: 400

      205 |       }
      206 |     } catch (error) {
    > 207 |       console.error(`[SyncManager] Failed to sync card add: ${error.message}`);
          |               ^
      208 |       return this.handleRetry(operation);
      209 |     }
      210 |   }

      at SyncManager.error [as syncCardAdd] (services/sync/syncManager.js:207:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:132:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/cardOperationIntegration.e2e.test.js:244:20)

  console.error
    [SyncManager] Failed to sync card update: API error: 404

      238 |       }
      239 |     } catch (error) {
    > 240 |       console.error(`[SyncManager] Failed to sync card update: ${error.message}`);
          |               ^
      241 |       return this.handleRetry(operation);
      242 |     }
      243 |   }

      at SyncManager.error [as syncCardUpdate] (services/sync/syncManager.js:240:15)
      at SyncManager.syncOperation (services/sync/syncManager.js:134:18)
      at SyncManager.processQueue (services/sync/syncManager.js:90:23)
      at Object.<anonymous> (__tests__/e2e/cardOperationIntegration.e2e.test.js:288:22)

PASS __tests__/e2e/cardOperationIntegration.e2e.test.js
  E2E: Card Operation Integration
    Complete Card Management Workflow
      âœ“ should complete full card add â†’ update â†’ delete workflow offline (25 ms)
    Card Operation with Message Interleaving
      âœ“ should maintain FIFO order with mixed card and message operations (2 ms)
    Multiple Card Operations Simultaneously Offline
      âœ“ should queue operations for multiple cards (1 ms)
    Card Operation Failures and Retries
      âœ“ should retry failed card add operation (10 ms)
      âœ“ should handle partial card operation failure (5 ms)
    Card Operation API Validation
      âœ“ should send correct API endpoint for each card operation (6 ms)
      âœ“ should include all required fields in card operation payloads (2 ms)
    Card Operation Events
      âœ“ should emit events for each card operation (2 ms)
    Large-Scale Card Operations
      âœ“ should handle bulk card operations (2 ms)

  console.warn
    [CardMigration] Input is not an array, returning as-is

      320 | export function migrateCards(cards) {
      321 |   if (!Array.isArray(cards)) {
    > 322 |     console.warn('[CardMigration] Input is not an array, returning as-is');
          |             ^
      323 |     return cards;
      324 |   }
      325 |

      at warn (services/cardMigration/cardMigrationHelper.js:322:13)
      at Object.<anonymous> (__tests__/unit/cardMigration.test.js:261:34)

PASS __tests__/unit/offline/indexedDB.test.js
  IndexedDB Manager
    savePendingMessage
      âœ“ should save a pending message with correct fields (2 ms)
      âœ“ should generate unique IDs for multiple messages (140 ms)
    getPendingMessages
      âœ“ should return array of pending messages (1 ms)
    markMessageSynced
      âœ“ should mark message as synced (1 ms)
    Database initialization
      âœ“ should create database with correct name
      âœ“ should have correct version
      âœ“ should have all required stores configured (1 ms)
      âœ“ pending_messages store should have correct indexes (1 ms)
      âœ“ pending_payments store should have correct indexes (1 ms)
    Manager initialization
      âœ“ should be singleton instance (2 ms)
      âœ“ should have open method
      âœ“ should have put method
      âœ“ should have get method (1 ms)
      âœ“ should have delete method
      âœ“ should have clearStore method (1 ms)
    Data operations
      âœ“ put method should accept storeName and data (1 ms)
      âœ“ get method should accept storeName and key
      âœ“ getAllByIndex method should exist (2 ms)
      âœ“ getStats method should exist
    Message operations
      âœ“ savePendingMessage should return a promise (1 ms)
      âœ“ getPendingMessages should return a promise
      âœ“ markMessageSynced should return a promise (1 ms)
    Payment operations
      âœ“ savePendingPayment should return a promise (3 ms)
      âœ“ getPendingPayments should return a promise (1 ms)
      âœ“ markPaymentSynced should return a promise
    Chat history operations
      âœ“ saveChatMessage should return a promise (1 ms)
      âœ“ getChatHistory should return a promise (1 ms)
    Sync log operations
      âœ“ addSyncLog should return a promise (1 ms)

PASS __tests__/unit/cardMigration.test.js
  Card Migration Helper - Phase 2
    needsMigration - Detection Logic
      âœ“ detects MVP 3-category card needs migration (1 ms)
      âœ“ detects MVP 5-category card needs migration
      âœ“ detects Phase 2 card does NOT need migration
      âœ“ handles null reward_structure gracefully (15 ms)
      âœ“ handles missing reward_structure (1 ms)
      âœ“ handles null card gracefully
    migrateCard - Single Card Migration
      âœ“ migrates MVP 3-category dining specialist card (2 ms)
      âœ“ migrates MVP 5-category card with online category (1 ms)
      âœ“ preserves card identity during migration (1 ms)
      âœ“ handles card with no reward structure gracefully (1 ms)
      âœ“ returns already-migrated card unchanged
    migrateCards - Batch Migration
      âœ“ migrates multiple cards at once (1 ms)
      âœ“ handles empty array gracefully
      âœ“ handles non-array input gracefully (28 ms)
    getMigrationReport - Portfolio Analysis
      âœ“ generates accurate migration report for mixed portfolio (1 ms)
      âœ“ correctly counts category counts in report (1 ms)
      âœ“ handles null portfolio gracefully (2 ms)
      âœ“ handles empty portfolio (2 ms)
    validateMigratedCard - Validation Logic
      âœ“ validates correct Phase 2 card structure
      âœ“ detects missing reward_structure (2 ms)
      âœ“ detects invalid multiplier values (2 ms)
      âœ“ warns about unusually high multipliers (1 ms)
      âœ“ warns about missing categories
    getMigrationSummary - Human-Readable Reports
      âœ“ generates readable summary text (1 ms)
      âœ“ includes migration status indicators (2 ms)
      âœ“ handles empty portfolio
    Category Migration Mapping
      âœ“ exposes category migration mappings (1 ms)
      âœ“ mapping has newCategory and aliases (1 ms)
    Migration Strategy Patterns
      âœ“ exposes migration strategy templates (1 ms)
      âœ“ strategies provide reasonable defaults for all categories (1 ms)
    Real-World Migration Scenarios
      âœ“ migrates user with mixed MVP and Phase 2 cards (1 ms)
      âœ“ handles user onboarding with legacy data (2 ms)

PASS __tests__/integration/offline/offlineFlow.test.js
  Offline Flow Integration
    Chat message offline queueing
      âœ“ should queue message when offline (39 ms)
      âœ“ should retrieve queued messages (8 ms)
      âœ“ should mark message as synced (11 ms)
    Payment offline queueing
      âœ“ should queue payment when offline (4 ms)
      âœ“ should retrieve queued payments (6 ms)
      âœ“ should mark payment as synced (9 ms)
    Chat history offline storage
      âœ“ should save chat messages offline (3 ms)
      âœ“ should retrieve chat history (43 ms)
    Sync log tracking
      âœ“ should log sync start (7 ms)
      âœ“ should log sync completion (4 ms)
      âœ“ should log sync errors (11 ms)
    Offline to Online transition
      âœ“ should trigger sync when coming online (35 ms)
      âœ“ should not sync if already syncing
      âœ“ should queue multiple items then sync (32 ms)
    Database stats
      âœ“ should track database statistics (21 ms)
      âœ“ stats should show pending counts (10 ms)
    Detector event flow
      âœ“ should emit online event (5 ms)
      âœ“ should emit offline event
      âœ“ should emit sync events (5 ms)
    Multiple pending operations
      âœ“ should handle messages, payments and chat together (6 ms)
      âœ“ should clear individual items without affecting others (5 ms)
    Error handling
      âœ“ should handle detector errors gracefully (2 ms)
      âœ“ should continue operation after sync failure (9 ms)

Summary of all failing tests
FAIL __tests__/unit/components/ToastNotification.test.js
  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'indexOf')

       5 |
       6 | describe('ToastNotification', () => {
    >  7 |   describe('Types', () => {
         |                 ^
       8 |     test('should render success toast', () => {
       9 |       render(<ToastNotification type="success" message="Operation successful" />);
      10 |       expect(screen.getByText('Operation successful')).toBeInTheDocument();

      at node_modules/react-dom/cjs/react-dom.development.js:29890:29
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom.development.js:29922:5)
      at Object.<anonymous> (node_modules/react-dom/index.js:37:20)
      at node_modules/react-dom/cjs/react-dom-test-utils.development.js:18:16
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1762:5)
      at Object.<anonymous> (node_modules/react-dom/test-utils.js:6:20)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/act-compat.js:10:56)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/index.js:6:18)
      at Object.<anonymous> (__tests__/unit/components/ToastNotification.test.js:7:17)

FAIL __tests__/unit/components/SyncStatus.test.js
  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'indexOf')

       5 |
       6 | describe('SyncStatus', () => {
    >  7 |   const mockOperations = [
         |                 ^
       8 |     {
       9 |       id: 'op-1',
      10 |       type: 'message',

      at node_modules/react-dom/cjs/react-dom.development.js:29890:29
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom.development.js:29922:5)
      at Object.<anonymous> (node_modules/react-dom/index.js:37:20)
      at node_modules/react-dom/cjs/react-dom-test-utils.development.js:18:16
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1762:5)
      at Object.<anonymous> (node_modules/react-dom/test-utils.js:6:20)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/act-compat.js:10:56)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/index.js:6:18)
      at Object.<anonymous> (__tests__/unit/components/SyncStatus.test.js:7:17)

FAIL __tests__/unit/components/OfflineIndicator.test.js
  â— Test suite failed to run

    TypeError: Cannot read properties of undefined (reading 'indexOf')

       5 |
       6 | describe('OfflineIndicator', () => {
    >  7 |   describe('Online Status', () => {
         |                 ^
       8 |     test('should not show when online with no pending operations', () => {
       9 |       const { container } = render(
      10 |         <OfflineIndicator isOnline={true} queueLength={0} syncStatus="idle" />

      at node_modules/react-dom/cjs/react-dom.development.js:29890:29
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom.development.js:29922:5)
      at Object.<anonymous> (node_modules/react-dom/index.js:37:20)
      at node_modules/react-dom/cjs/react-dom-test-utils.development.js:18:16
      at Object.<anonymous> (node_modules/react-dom/cjs/react-dom-test-utils.development.js:1762:5)
      at Object.<anonymous> (node_modules/react-dom/test-utils.js:6:20)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/act-compat.js:10:56)
      at Object.<anonymous> (node_modules/@testing-library/react/dist/index.js:6:18)
      at Object.<anonymous> (__tests__/unit/components/OfflineIndicator.test.js:7:17)

FAIL __tests__/unit/reminderPlanner.test.js
  â— Reminder Planner - Baseline Schedule â€º includes day-of and post-due reminder when payment is due today

    expect(received).toHaveLength(expected)

    Expected length: 2
    Received length: 1
    Received array:  [{"card_id": "card-2", "channel": ["in_app"], "id": "card-2-payment_due-1762790400000", "lead_time_days": 0, "payload": {"amountDue": 1000, "cardNickname": "Bofa Travel", "daysUntilDue": 1, "dueDate": "2025-11-10T08:00:00.000Z", "urgency": "soon", "urgencyEmoji": "ï¿½ï¿½"}, "priority": 100, "reminder_type": "payment_due", "status": "scheduled", "target_datetime": "2025-11-10T16:00:00.000Z", "trigger_date": "2025-11-10", "user_id": "user-123"}]

      79 |
      80 |     // -3 (Nov 7) should be filtered because it's in the past; expect day-of + post-due
    > 81 |     expect(reminders).toHaveLength(2);
         |                       ^
      82 |     expect(reminders.map(r => r.lead_time_days)).toEqual([0, 1]);
      83 |     const dayOf = new Date(reminders[0].target_datetime);
      84 |     const postDue = new Date(reminders[1].target_datetime);

      at Object.toHaveLength (__tests__/unit/reminderPlanner.test.js:81:23)

  â— Reminder Planner - Baseline Schedule â€º respects quiet hours by shifting to end of quiet window

    expect(received).toHaveLength(expected)

    Expected length: 1
    Received length: 0
    Received array:  []

      140 |     });
      141 |
    > 142 |     expect(reminders).toHaveLength(1);
          |                       ^
      143 |     const reminderDate = new Date(reminders[0].target_datetime);
      144 |     expect(reminderDate.getHours()).toBe(8); // shifted to quietHours.end
      145 |   });

      at Object.toHaveLength (__tests__/unit/reminderPlanner.test.js:142:23)

FAIL __tests__/unit/fieldExtraction.test.js (5.31 s)
  â— Field Extraction - extractAttribute â€º Identity Fields â€º extracts card_type

    expect(received).toBe(expected) // Object.is equality

    Expected: "card_type"
    Received: null

      31 |
      32 |     test('extracts card_type', () => {
    > 33 |       expect(getAttribute("what type of card is this")).toBe('card_type');
         |                                                         ^
      34 |       expect(getAttribute("what kind of card")).toBe('card_type');
      35 |       expect(getAttribute("card kind")).toBe('card_type');
      36 |     });

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:33:57)

  â— Field Extraction - extractAttribute â€º Financial Fields â€º extracts apr

    expect(received).toBe(expected) // Object.is equality

    Expected: "apr"
    Received: null

      60 |       expect(getAttribute("interest rate")).toBe('apr');
      61 |       expect(getAttribute("annual percentage rate")).toBe('apr');
    > 62 |       expect(getAttribute("show me rate")).toBe('apr');
         |                                            ^
      63 |     });
      64 |
      65 |     test('extracts balance', () => {

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:62:44)

  â— Field Extraction - extractAttribute â€º Financial Fields â€º extracts credit_limit

    expect(received).toBe(expected) // Object.is equality

    Expected: "credit_limit"
    Received: null

      75 |       expect(getAttribute("show me limit")).toBe('credit_limit');
      76 |       expect(getAttribute("maximum credit")).toBe('credit_limit');
    > 77 |       expect(getAttribute("max credit")).toBe('credit_limit');
         |                                          ^
      78 |     });
      79 |
      80 |     test('extracts annual_fee', () => {

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:77:42)

  â— Field Extraction - extractAttribute â€º Date/Time Fields â€º extracts due_date

    expect(received).toBe(expected) // Object.is equality

    Expected: "due_date"
    Received: null

       98 |       expect(getAttribute("due date")).toBe('due_date');
       99 |       expect(getAttribute("when due")).toBe('due_date');
    > 100 |       expect(getAttribute("payment due")).toBe('due_date');
          |                                           ^
      101 |     });
      102 |
      103 |     test('extracts statement_close', () => {

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:100:43)

  â— Field Extraction - extractAttribute â€º Rewards Fields â€º extracts rewards

    expect(received).toBe(expected) // Object.is equality

    Expected: "rewards"
    Received: null

      144 |       expect(getAttribute("show me points")).toBe('rewards');
      145 |       expect(getAttribute("cashback rate")).toBe('rewards');
    > 146 |       expect(getAttribute("how much can I earn")).toBe('rewards');
          |                                                   ^
      147 |       // "miles earning" may not trigger rewards attribute (earn might not match pattern)
      148 |       // Check if it extracts or not - both are acceptable
      149 |       const attr = getAttribute("miles earning");

      at Object.toBe (__tests__/unit/fieldExtraction.test.js:146:51)

FAIL __tests__/unit/fieldMapping.test.js (5.707 s)
  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps issuer variations to issuer

    expect(received).toBe(expected) // Object.is equality

    Expected: "issuer"
    Received: undefined

      50 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      51 |       
    > 52 |       expect(structured.grouping).toBe('issuer');
         |                                   ^
      53 |     });
      54 |
      55 |     test('maps card_network variations to card_network', () => {

      at Object.toBe (__tests__/unit/fieldMapping.test.js:52:35)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps card_network variations to card_network

    expect(received).toBe(expected) // Object.is equality

    Expected: "card_network"
    Received: undefined

      59 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      60 |       
    > 61 |       expect(structured.grouping).toBe('card_network');
         |                                   ^
      62 |     });
      63 |
      64 |     test('maps card_type variations to card_type', () => {

      at Object.toBe (__tests__/unit/fieldMapping.test.js:61:35)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps card_type variations to card_type

    expect(received).toBe(expected) // Object.is equality

    Expected: "card_type"
    Received: undefined

      68 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      69 |       
    > 70 |       expect(structured.grouping).toBe('card_type');
         |                                   ^
      71 |     });
      72 |
      73 |     test('maps card_name variations to card_name', () => {

      at Object.toBe (__tests__/unit/fieldMapping.test.js:70:35)

  â— Field Mapping - QueryDecomposer._mapField â€º Identity Fields Mapping â€º maps card_name variations to card_name

    expect(received).toBeTruthy()

    Received: null

      79 |       
      80 |       // card_name sorting is less common, but should map correctly
    > 81 |       expect(structured.sorting?.field || null).toBeTruthy();
         |                                                 ^
      82 |     });
      83 |   });
      84 |

      at Object.toBeTruthy (__tests__/unit/fieldMapping.test.js:81:49)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps balance variations to current_balance

    TypeError: Cannot read properties of undefined (reading 'field')

      91 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      92 |       
    > 93 |       expect(structured.sorting.field).toBe('current_balance');
         |                                 ^
      94 |     });
      95 |
      96 |     test('maps apr variations to apr', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:93:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps apr variations to apr

    TypeError: Cannot read properties of undefined (reading 'field')

      101 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      102 |       
    > 103 |       expect(structured.sorting.field).toBe('apr');
          |                                 ^
      104 |     });
      105 |
      106 |     test('maps credit_limit variations to credit_limit', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:103:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps credit_limit variations to credit_limit

    TypeError: Cannot read properties of undefined (reading 'field')

      111 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      112 |       
    > 113 |       expect(structured.sorting.field).toBe('credit_limit');
          |                                 ^
      114 |     });
      115 |
      116 |     test('maps annual_fee variations to annual_fee', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:113:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Financial Fields Mapping â€º maps annual_fee variations to annual_fee

    TypeError: Cannot read properties of undefined (reading 'field')

      121 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      122 |       
    > 123 |       expect(structured.sorting.field).toBe('annual_fee');
          |                                 ^
      124 |     });
      125 |   });
      126 |

      at Object.field (__tests__/unit/fieldMapping.test.js:123:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Date Fields Mapping â€º maps due_date variations correctly

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["payment_due_date", "payment_due_day"]

      133 |       
      134 |       // Should map to payment_due_date or payment_due_day
    > 135 |       expect(['payment_due_date', 'payment_due_day']).toContain(structured.sorting?.field || null);
          |                                                       ^
      136 |     });
      137 |
      138 |     test('maps statement_close variations correctly', () => {

      at Object.toContain (__tests__/unit/fieldMapping.test.js:135:55)

  â— Field Mapping - QueryDecomposer._mapField â€º Date Fields Mapping â€º maps statement_close variations correctly

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["statement_cycle_end", "statement_close_day"]

      143 |       
      144 |       // Should map to statement_cycle_end or statement_close_day
    > 145 |       expect(['statement_cycle_end', 'statement_close_day']).toContain(structured.sorting?.field || null);
          |                                                              ^
      146 |     });
      147 |
      148 |     test('maps grace_period variations to grace_period_days', () => {

      at Object.toContain (__tests__/unit/fieldMapping.test.js:145:62)

  â— Field Mapping - QueryDecomposer._mapField â€º Date Fields Mapping â€º maps grace_period variations to grace_period_days

    TypeError: Cannot read properties of undefined (reading 'field')

      153 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      154 |       
    > 155 |       expect(structured.sorting.field).toBe('grace_period_days');
          |                                 ^
      156 |     });
      157 |   });
      158 |

      at Object.field (__tests__/unit/fieldMapping.test.js:155:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Computed Fields Mapping â€º maps utilization variations to utilization

    TypeError: Cannot read properties of undefined (reading 'field')

      165 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      166 |       
    > 167 |       expect(structured.sorting.field).toBe('utilization');
          |                                 ^
      168 |     });
      169 |
      170 |     test('maps available_credit variations to available_credit', () => {

      at Object.field (__tests__/unit/fieldMapping.test.js:167:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Computed Fields Mapping â€º maps available_credit variations to available_credit

    TypeError: Cannot read properties of undefined (reading 'field')

      175 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      176 |       
    > 177 |       expect(structured.sorting.field).toBe('available_credit');
          |                                 ^
      178 |     });
      179 |   });
      180 |

      at Object.field (__tests__/unit/fieldMapping.test.js:177:33)

  â— Field Mapping - QueryDecomposer._mapField â€º Aggregation Field Mapping â€º maps balance in aggregations to current_balance

    TypeError: Cannot read properties of undefined (reading '0')

      186 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      187 |       
    > 188 |       expect(structured.aggregations[0].field).toBe('current_balance');
          |                                     ^
      189 |     });
      190 |
      191 |     test('maps apr in aggregations to apr', () => {

      at Object.<anonymous> (__tests__/unit/fieldMapping.test.js:188:37)

  â— Field Mapping - QueryDecomposer._mapField â€º Aggregation Field Mapping â€º maps apr in aggregations to apr

    TypeError: Cannot read properties of undefined (reading '0')

      195 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      196 |       
    > 197 |       expect(structured.aggregations[0].field).toBe('apr');
          |                                     ^
      198 |     });
      199 |
      200 |     test('maps credit_limit in aggregations to credit_limit', () => {

      at Object.<anonymous> (__tests__/unit/fieldMapping.test.js:197:37)

  â— Field Mapping - QueryDecomposer._mapField â€º Aggregation Field Mapping â€º maps credit_limit in aggregations to credit_limit

    TypeError: Cannot read properties of undefined (reading '0')

      204 |       const structured = decomposer.decompose(query, entities, 'query_card_data');
      205 |       
    > 206 |       expect(structured.aggregations[0].field).toBe('credit_limit');
          |                                     ^
      207 |     });
      208 |   });
      209 |

      at Object.<anonymous> (__tests__/unit/fieldMapping.test.js:206:37)

FAIL __tests__/unit/endToEndFieldMapping.test.js (5.887 s)
  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º balance query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      106 |
      107 |       expect(entities.attribute).toBe('balance');
    > 108 |       expect(structured.sorting.field).toBe('current_balance');
          |                                 ^
      109 |       expect(results.results).toBeDefined();
      110 |       expect(Array.isArray(results.results)).toBe(true);
      111 |       

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:108:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º APR query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      125 |
      126 |       expect(entities.attribute).toBe('apr');
    > 127 |       expect(structured.sorting.field).toBe('apr');
          |                                 ^
      128 |       expect(results.results).toBeDefined();
      129 |       
      130 |       // Results should be sorted by APR (ascending for lowest)

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:127:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º credit_limit query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      141 |
      142 |       expect(entities.attribute).toBe('credit_limit');
    > 143 |       expect(structured.sorting.field).toBe('credit_limit');
          |                                 ^
      144 |       expect(results.results).toBeDefined();
      145 |     });
      146 |

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:143:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º annual_fee query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      152 |
      153 |       expect(entities.attribute).toBe('annual_fee');
    > 154 |       expect(structured.sorting.field).toBe('annual_fee');
          |                                 ^
      155 |       expect(results.results).toBeDefined();
      156 |     });
      157 |

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:154:33)

  â— End-to-End Field Mapping â€º Financial Fields End-to-End â€º total balance aggregation extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'length')

      163 |
      164 |       // Should aggregate on current_balance
    > 165 |       if (structured.aggregations.length > 0) {
          |                                   ^
      166 |         expect(structured.aggregations[0].field).toBe('current_balance');
      167 |         expect(structured.aggregations[0].operation).toBe('sum');
      168 |       }

      at Object.length (__tests__/unit/endToEndFieldMapping.test.js:165:35)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º issuer distinct query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      179 |
      180 |       expect(entities.distinctQuery).toBeDefined();
    > 181 |       expect(structured.distinct.field).toBe('issuer');
          |                                  ^
      182 |       expect(results.values).toBeDefined();
      183 |       
      184 |       // Should return distinct issuers

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:181:34)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º card_network distinct query extracts and maps correctly

    expect(received).toBeDefined()

    Received: undefined

      193 |       const results = executor.execute(structured);
      194 |
    > 195 |       expect(structured.distinct).toBeDefined();
          |                                   ^
      196 |       expect(structured.distinct.field).toBe('card_network');
      197 |       expect(results.values).toBeDefined();
      198 |     });

      at Object.toBeDefined (__tests__/unit/endToEndFieldMapping.test.js:195:35)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º issuer filter extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      205 |
      206 |       // Should filter by issuer
    > 207 |       const issuerFilter = structured.filters.find(f => f.field === 'issuer');
          |                                               ^
      208 |       if (issuerFilter) {
      209 |         expect(issuerFilter.field).toBe('issuer');
      210 |         expect(issuerFilter.value).toBe('Chase');

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:207:47)

  â— End-to-End Field Mapping â€º Identity Fields End-to-End â€º network filter extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      220 |
      221 |       // Should filter by card_network
    > 222 |       const networkFilter = structured.filters.find(f => f.field === 'card_network');
          |                                                ^
      223 |       if (networkFilter) {
      224 |         expect(networkFilter.field).toBe('card_network');
      225 |       }

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:222:48)

  â— End-to-End Field Mapping â€º Date Fields End-to-End â€º due_date query extracts and maps correctly

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["payment_due_date", "payment_due_day"]

      237 |       expect(entities.attribute).toBe('due_date');
      238 |       // Should map to payment_due_date or payment_due_day
    > 239 |       expect(['payment_due_date', 'payment_due_day']).toContain(structured.sorting?.field || null);
          |                                                       ^
      240 |       expect(results.results).toBeDefined();
      241 |     });
      242 |

      at Object.toContain (__tests__/unit/endToEndFieldMapping.test.js:239:55)

  â— End-to-End Field Mapping â€º Date Fields End-to-End â€º grace_period query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      248 |
      249 |       expect(entities.attribute).toBe('grace_period');
    > 250 |       expect(structured.sorting.field).toBe('grace_period_days');
          |                                 ^
      251 |       expect(results.results).toBeDefined();
      252 |     });
      253 |   });

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:250:33)

  â— End-to-End Field Mapping â€º Computed Fields End-to-End â€º utilization query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      261 |
      262 |       expect(entities.attribute).toBe('utilization');
    > 263 |       expect(structured.sorting.field).toBe('utilization');
          |                                 ^
      264 |       expect(results.results).toBeDefined();
      265 |     });
      266 |

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:263:33)

  â— End-to-End Field Mapping â€º Computed Fields End-to-End â€º available_credit query extracts and maps correctly

    TypeError: Cannot read properties of undefined (reading 'field')

      272 |
      273 |       expect(entities.attribute).toBe('available_credit');
    > 274 |       expect(structured.sorting.field).toBe('available_credit');
          |                                 ^
      275 |       expect(results.results).toBeDefined();
      276 |     });
      277 |   });

      at Object.field (__tests__/unit/endToEndFieldMapping.test.js:274:33)

  â— End-to-End Field Mapping â€º Balance Filter End-to-End â€º with_balance filter extracts and filters correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      285 |
      286 |       expect(entities.balanceFilter).toBe('with_balance');
    > 287 |       const balanceFilter = structured.filters.find(f => f.field === 'current_balance');
          |                                                ^
      288 |       expect(balanceFilter).toBeDefined();
      289 |       expect(balanceFilter.operator).toBe('>');
      290 |       expect(balanceFilter.value).toBe(0);

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:287:48)

  â— End-to-End Field Mapping â€º Balance Filter End-to-End â€º zero_balance filter extracts and filters correctly

    TypeError: Cannot read properties of undefined (reading 'find')

      303 |
      304 |       expect(entities.balanceFilter).toBe('zero_balance');
    > 305 |       const balanceFilter = structured.filters.find(f => f.field === 'current_balance');
          |                                                ^
      306 |       expect(balanceFilter).toBeDefined();
      307 |       expect(balanceFilter.operator).toBe('==');
      308 |       expect(balanceFilter.value).toBe(0);

      at Object.find (__tests__/unit/endToEndFieldMapping.test.js:305:48)

  â— End-to-End Field Mapping â€º Grouped Aggregation End-to-End â€º total balance by issuer extracts and maps correctly

    expect(received).toBe(expected) // Object.is equality

    Expected: "issuer"
    Received: undefined

      323 |
      324 |       expect(entities.grouping).toBeDefined();
    > 325 |       expect(structured.grouping).toBe('issuer');
          |                                   ^
      326 |       expect(structured.aggregations[0].field).toBe('current_balance');
      327 |       expect(structured.aggregations[0].operation).toBe('sum');
      328 |       expect(results.results).toBeDefined();

      at Object.toBe (__tests__/unit/endToEndFieldMapping.test.js:325:35)

  â— End-to-End Field Mapping â€º Complex Queries End-to-End â€º compound filter with balance and APR extracts correctly

    TypeError: Cannot read properties of undefined (reading 'length')

      344 |       const results = executor.execute(structured);
      345 |
    > 346 |       expect(structured.filters.length).toBeGreaterThan(0);
          |                                 ^
      347 |       expect(results.results).toBeDefined();
      348 |       
      349 |       // Verify filters are applied correctly

      at Object.length (__tests__/unit/endToEndFieldMapping.test.js:346:33)

  â— End-to-End Field Mapping â€º Complex Queries End-to-End â€º distinct issuers with balance filter extracts correctly

    expect(received).toBeDefined()

    Received: undefined

      364 |       const results = executor.execute(structured);
      365 |
    > 366 |       expect(structured.distinct).toBeDefined();
          |                                   ^
      367 |       expect(structured.distinct.field).toBe('issuer');
      368 |       expect(structured.filters.length).toBeGreaterThan(0);
      369 |       expect(results.values).toBeDefined();

      at Object.toBeDefined (__tests__/unit/endToEndFieldMapping.test.js:366:35)

FAIL __tests__/unit/userEnteredFields.test.js (6.443 s)
  â— User-Entered Card Fields - Extraction Tests â€º 1. IDENTITY FIELDS â€º 1.1 card_name (Required for manual entry) â€º extracts from "what card is this"

    expect(received).toBeTruthy()

    Received: null

      90 |         // It's more of a general listing query
      91 |         const entities = extractEntities(query);
    > 92 |         expect(entities.queryType).toBeTruthy();
         |                                    ^
      93 |       });
      94 |
      95 |       test('extracts from "card title"', () => {

      at Object.toBeTruthy (__tests__/unit/userEnteredFields.test.js:92:36)

  â— User-Entered Card Fields - Extraction Tests â€º 1. IDENTITY FIELDS â€º 1.2 nickname (Optional user-friendly name) â€º extracts from "what is my card nickname"

    expect(received).toBe(expected) // Object.is equality

    Expected: "nickname"
    Received: "card_name"

      102 |       test('extracts from "what is my card nickname"', () => {
      103 |         const query = "what is my card nickname";
    > 104 |         expect(getAttribute(query)).toBe('nickname');
          |                                     ^
      105 |       });
      106 |
      107 |       test('extracts from "show me nickname"', () => {

      at Object.toBe (__tests__/unit/userEnteredFields.test.js:104:37)

  â— User-Entered Card Fields - Extraction Tests â€º 1. IDENTITY FIELDS â€º 1.2 nickname (Optional user-friendly name) â€º extracts from "what did I name this card"

    expect(received).toContain(expected) // indexOf

    Expected value: null
    Received array: ["nickname", "card_name"]

      119 |         // Should extract nickname or card_name
      120 |         const entities = extractEntities(query);
    > 121 |         expect(['nickname', 'card_name']).toContain(entities.attribute);
          |                                           ^
      122 |       });
      123 |     });
      124 |

      at Object.toContain (__tests__/unit/userEnteredFields.test.js:121:43)

  â— User-Entered Card Fields - Extraction Tests â€º 6. END-TO-END QUERIES FOR ALL USER-ENTERED FIELDS â€º nickname: "what is my card nickname" â†’ extracts and queries

    expect(received).toBe(expected) // Object.is equality

    Expected: "nickname"
    Received: "card_name"

      524 |       const results = executor.execute(structured);
      525 |
    > 526 |       expect(entities.attribute).toBe('nickname');
          |                                  ^
      527 |       expect(results).toBeDefined();
      528 |     });
      529 |

      at Object.toBe (__tests__/unit/userEnteredFields.test.js:526:34)


Test Suites: 8 failed, 38 passed, 46 total
Tests:       45 failed, 1333 passed, 1378 total
Snapshots:   0 total
Time:        14.825 s
Ran all test suites.
